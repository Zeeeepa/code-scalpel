# [20260106_TEST] Additional vulnerability type coverage for security_scan
from __future__ import annotations

import pytest

pytestmark = pytest.mark.asyncio


async def test_xss_detection_python_template():
    """Community: Detect XSS via Python template rendering pattern."""
    code = (
        "from flask import render_template_string\n"
        "def view(user_input):\n"
        "    return render_template_string('<p>' + user_input + '</p>')\n"
    )
    from code_scalpel.mcp.server import security_scan

    result = await security_scan(code=code)

    assert result.success is True
    assert any(
        v.cwe == "CWE-79" or "xss" in v.type.lower() for v in result.vulnerabilities
    )


async def test_path_traversal_detection():
    """Community: Detect path traversal via tainted file access."""
    code = (
        "from flask import request\n"
        "def read():\n"
        "    filename = request.args.get('file')\n"
        "    with open('/data/' + filename) as f:\n"
        "        return f.read()\n"
    )
    from code_scalpel.mcp.server import security_scan

    result = await security_scan(code=code)

    assert result.success is True
    assert any(
        v.cwe == "CWE-22" or "path" in v.type.lower() for v in result.vulnerabilities
    )
