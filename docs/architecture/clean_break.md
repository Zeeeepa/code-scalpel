Code Scalpel Clean Break Implementation Checklist
**Status Legend:** â¬œ Not Started | ðŸŸ¨ In Progress | âœ… Complete | âš ï¸ Blocked

## Executive Summary
Transform Code Scalpel from a 788KB monolithic MCP server into a plugin-based architecture with three independently distributed packages:
- **code-scalpel (Community)** - Public PyPI package (~250KB core)
- **code-scalpel-pro (Pro)** - Private package (~300KB extension)
- **code-scalpel-enterprise (Enterprise)** - Private package (~300KB extension)

**Goals:** 
- âœ… Private IP protection (Pro/Enterprise code in separate private repos)
- âœ… Smaller packages (Community: 68% size reduction)
- âœ… Independent release cycles per tier
- âœ… Seamless JWT-based upgrade experience preserved

---

## Pre-Flight Checklist

### Development Strategy
**Current Phase:** Preparing v3.3.0 release in `/mnt/k/backup/Develop/code-scalpel/` (final monorepo release)
**Target Repos:** `code_scalpel_community/`, `code_scalpel_pro/`, and `code_scalpel_enterprise/` cloned and ready
**Timeline:** 
- **Now:** Complete pre-flight checks, finalize v3.3.0 monorepo release
- **After v3.3.0 release:** Begin Phase 2 code extraction into separate repos
**Pre-Flight Purpose:** Any issues found will be addressed in v3.3.0 pre-release testing/development

### Critical Verification Before Starting

- [X] **Backup complete monolith** - Full copy of current `/mnt/k/backup/Develop/code-scalpel/`
- [X] **Git history archived** - Tag current state as `v3.3.0-final-monolith` (pending final release)
- [X] **Fix test collection errors** - âœ… **COMPLETED:** All 3 errors resolved (2025-01-09)
  - âœ… Fixed mock patch in `tests/test_missing_limits_toml.py` (features â†’ config_loader)
  - âœ… Renamed `tests/test_no_limits_file.py` to `manual_test_no_limits_file.py` (script-style test)
  - âœ… Created root `conftest.py` with pytest_plugins (pytest 9.x compatibility)
  - âœ… Added `slow` marker to `pytest.ini`
  - **Result:** 6,690 tests collected successfully with 0 errors
- [âœ…] **Existing tests pass** - Full run completed; 5 Enterprise-tier autonomy failures backburned (non-blocking)
  - **Backburned tests (5):**
    - tests/autonomy/test_autonomy_autogen.py::TestAutoGenIntegration::{test_scalpel_validate_impl_safe_code, test_scalpel_validate_impl_vulnerable_code, test_workflow_integration}
    - tests/autonomy/test_autonomy_crewai.py::TestCrewAIIntegration::{test_scalpel_security_scan_tool_safe, test_scalpel_security_scan_tool_vulnerable}
  - **Impact:** Enterprise-tier features; scheduled for v3.3.1+ or Enterprise sprint
  - **Log:** test_results_full.log
  - **Coverage:** Generated and ready for review
- [âœ…] **Document current test coverage** - Baseline captured (2026-01-09)
  - Coverage report: `htmlcov/index.html` (generated by full test run)
  - **Baseline: 44.96%** (6,685 passed / 5 backburned)
  - Note: Low coverage is pre-split monorepo baseline; will improve post-split with focused test suites
- [ðŸŸ¨] **Inventory Pro/Enterprise code** - Initial grep complete; triage pending
  - Command run; results saved to [PRO_ENTERPRISE_INVENTORY.md](PRO_ENTERPRISE_INVENTORY.md) (docs-heavy, needs filtering for real code paths; server/ not present)
  - Next: Cull false positives, tag actual proprietary logic to extract to Pro/Enterprise repos
- [âœ…] **Review license agreements** - MIT confirmed
  - `LICENSE` is MIT (3D Tech Solutions LLC, 2025); compatible with Community distribution
  - Optional: spot-check source headers later; no blocking actions identified
- [âœ…] **Customer communication drafted** - Template created and **FILLED**
  - Template at [docs/CUSTOMER_COMMUNICATION_v4.md](docs/CUSTOMER_COMMUNICATION_v4.md) (dates, artifact URLs, FAQ, support contacts)
  - Ready for: internal review â†’ customer email (1 week pre-GA) â†’ blog/docs (at GA)
- [ ] **Enhancement download infrastructure scoped** - CDN, auth, storage requirements
  - Private server URL planning: `https://dist.code-scalpel.io/pro/` and `/enterprise/`
  - JWT bearer token auth via `.netrc` or `PIP_INDEX_URL` env var
  - Wheel + requirements.txt artifacts
- [âœ…] **Version numbering confirmed** - Agreement on v4.0.0 as breaking release
  - v3.3.0 = final monorepo (tagged v3.3.0-final-monolith on 2026-01-09)
  - v4.0.0 = split architecture (Community/Pro/Enterprise), GA 2026-02-01

### Local Directory Structure Setup

**Location:** `/mnt/k/backup/Develop/` (workspace root)

- [X] **Clone Community repo:**
  ```bash
  cd /mnt/k/backup/Develop
  git clone https://github.com/tescolopio/code_scalpel_community.git
  # âœ… Cloned 2025-01-09
  ```
  
- [X] **Clone Pro repo:**
  ```bash
  cd /mnt/k/backup/Develop
  git clone https://github.com/tescolopio/code_scalpel_pro.git
  # âœ… Cloned 2025-01-09
  ```

- [X] **Clone Enterprise repo:**
  ```bash
  cd /mnt/k/backup/Develop
  git clone https://github.com/tescolopio/code_scalpel_enterprise.git
  # âœ… Cloned 2025-01-09
  ```

- [X] **Verify workspace structure:**
  ```bash
  ls -la /mnt/k/backup/Develop/ | grep code_scalpel
  # âœ… Confirmed 2025-01-09:
  # code-scalpel/              [monolith - v3.3.0 development]
  # code_scalpel_community/    [Community tier - from GitHub]
  # code_scalpel_pro/          [Pro tier - from GitHub]
  # code_scalpel_enterprise/   [Enterprise tier - from GitHub]
  ```

- [X] **Document this structure** in `/mnt/k/backup/Develop/README.md`:
  ```markdown
  ## Code Scalpel v4.0.0 Split - Development Structure (2025-01-09)
  
  - `code-scalpel/` - v3.3.0 monorepo (final monolithic release in development)
  - `code_scalpel_community/` - Community tier (public, cloned from GitHub)
  - `code_scalpel_pro/` - Pro tier enhancements (private, cloned from GitHub)
  - `code_scalpel_enterprise/` - Enterprise tier enhancements (private, cloned from GitHub)
  
  Status: v3.3.0 pre-release testing complete, ready for Phase 2 code extraction.
  ```

**Pre-Flight Status:** âœ… Repos cloned, collection fixed, full tests run (5 Enterprise-tier failures backburned)
**Next:** Document coverage, continue inventory/comms, prepare v3.3.0 release

## Architecture Overview

### CRITICAL DESIGN PRINCIPLES

- [ ] **Principle 1:** All 22 MCP tools available at ALL tiers - What differs is NOT which tools are available, but rather the capabilities, limits, and features within each tool
- [ ] **Principle 2:** MCP Server is primary interface - Users run `uvx code-scalpel` (not Python package installation)
- [ ] **Principle 3:** Dynamic runtime enhancement - License validation at boot â†’ automatic download of Pro/Enterprise code
- [ ] **Principle 4:** Novel MCP architecture - First MCP server to dynamically enhance itself based on licensing

### Community/Pro/Enterprise Tier Comparison

| Aspect | Community | Pro | Enterprise |
|--------|-----------|-----|------------|
| Distribution | Public PyPI | Private download | Private download |
| Cost | Free | Commercial | Commercial |
| Tools | 22 (basic) | 22 (enhanced) | 22 (full) |
| License | MIT/OSI | Proprietary | Proprietary |
| Source visibility | GitHub public | GitHub private | GitHub private |
| Max file size | 1MB | 10MB | 100MB |
| Analysis depth | 1-3 | 3-5 | Unlimited |
| Cross-file scope | Single file | 50 files | Unlimited |
| Custom rules | No | Yes | Yes + Governance |
| Compliance audit | No | No | Yes (HIPAA/SOC2/etc) |

## Primary Usage Flow & Workflows

### End-User Setup (No Code Changes Required)

```json
// IDE configuration (.vscode/mcp.json or similar)
{
  "mcpServers": {
    "code-scalpel": {
      "command": "uvx",
      "args": ["code-scalpel"]
    }
  }
}
```

### Community Tier User

1. `uvx code-scalpel` installs Community tier from PyPI
2. Server boots with ALL 22 tools at Community capabilities
3. No license needed, works out-of-box

### Pro/Enterprise User Workflow

```bash
# First run: Initialize configuration
$ code-scalpel init
# Creates ~/.code-scalpel/ with config structure

# User places license
cp license.jwt ~/.code-scalpel/license/

# Restart MCP server (via IDE)
# Server automatically:
# 1. Validates license.jwt â†’ detects Pro/Enterprise tier
# 2. Downloads enhancement code from private server
# 3. Dynamically loads Pro/Enterprise capabilities
# 4. ALL 22 tools now operate with enhanced capabilities
```

### Runtime Plugin Download Mechanism

```python
# At server startup:
def initialize_server():
    tier = validate_license()  # "community", "pro", or "enterprise"

    if tier in ["pro", "enterprise"]:
        download_tier_enhancements(tier)  # Download from private server
        load_tier_capabilities(tier)      # Dynamically import modules

    register_all_22_tools(tier)  # Register tools with appropriate capabilities
```

### Server Boot Sequence (Implementation Detail)

```python
def server_startup():
    # 1. Validate license
    license_data = validate_jwt_license()  # Returns tier + metadata

    # 2. Check if enhancement code already downloaded
    if tier in ["pro", "enterprise"]:
        enhancement_path = Path.home() / ".code-scalpel" / "enhancements" / tier

        if not enhancement_path.exists() or needs_update(tier):
            # 3. Download enhancement package from private server
            download_enhancement_package(
                tier=tier,
                target_dir=enhancement_path,
                auth_token=license_data["download_token"]
            )

        # 4. Load enhancement modules dynamically
        load_tier_enhancements(tier, enhancement_path)

    # 5. Register all 22 tools with appropriate capabilities
    register_mcp_tools(effective_tier=tier)
```

**Key Benefits:** No user action required for Pro users - License placement triggers automatic enhancement download

## Phase 1: Repository Setup & Preparation

**Timeline:** Week 1 | **Status:** âœ… Complete (2025-01-09)
**Outcome:** All three repos cloned and ready for Phase 2 code extraction

### Repository Creation Checklist

#### 1.1: Set Up Local Development Structure

**Strategy:** Keep monolith active for development, create local directories for iterative extraction
**Status:** âœ… Complete (Repos cloned from GitHub on 2025-01-09)

- [X] **Verify monolith location** - `/mnt/k/backup/Develop/code-scalpel/` remains active
- [X] **Clone Community repo** - `git clone https://github.com/tescolopio/code_scalpel_community.git`
- [X] **Clone Pro repo** - `git clone https://github.com/tescolopio/code_scalpel_pro.git`
- [X] **Clone Enterprise repo** - `git clone https://github.com/tescolopio/code_scalpel_enterprise.git`
- [X] **Verify directory structure:**
  ```bash
  ls -la /mnt/k/backup/Develop/ | grep code_scalpel
  # Shows:
  # code-scalpel/              [monolith - for reference/development]
  # code_scalpel_community/    [Community tier - cloned from GitHub]
  # code_scalpel_pro/          [Pro tier - cloned from GitHub]
  # code_scalpel_enterprise/   [Enterprise tier - cloned from GitHub]
  ```
- [ ] **Verify each repo connection:**
  ```bash
  cd code_scalpel_community && git remote -v  # Confirms GitHub connection
  cd ../code_scalpel_pro && git remote -v     # Confirms GitHub connection
  cd ../code_scalpel_enterprise && git remote -v  # Confirms GitHub connection
  ```
- [âœ…] **Tag monolith for reference** - `git tag -a v3.3.0-final-monolith` applied 2026-01-09
- [âœ…] **Document current structure** - Created `/mnt/k/backup/Develop/SPLIT_STRATEGY.md` with full development strategy and Phase 2 planning

**Note:** Repositories already exist on GitHub and are cloned locally. Ready to begin code extraction (Phase 2).

#### 1.2: GitHub Repository Configuration

**Status:** âœ… Repositories exist and are cloned locally
**GitHub Organization:** tescolopio

**Repository 1: code_scalpel_community (Community - Public)**
- [X] **Repository exists** - https://github.com/tescolopio/code_scalpel_community.git
- [X] **Cloned locally** - `/mnt/k/backup/Develop/code_scalpel_community/`
- [ ] **Verify visibility** - Confirm repo is set as public on GitHub
- [ ] **Review current structure:**
  ```
  code_scalpel_community/
  â”œâ”€â”€ .github/workflows/
  â”œâ”€â”€ src/code_scalpel/
  â”œâ”€â”€ tests/
  â”œâ”€â”€ docs/
  â”œâ”€â”€ examples/
  â”œâ”€â”€ pyproject.toml
  â”œâ”€â”€ README.md
  â”œâ”€â”€ LICENSE (MIT or Apache 2.0)
  â””â”€â”€ .gitignore
  ```
- [ ] **Set up branch protection:** `main` branch requires PR review
- [ ] **Configure CI/CD** (see 1.3)
- [ ] **Add PyPI publishing secrets** to GitHub Actions

**Repository 2: code_scalpel_pro (Pro - Private)**
- [X] **Repository exists** - https://github.com/tescolopio/code_scalpel_pro.git
- [X] **Cloned locally** - `/mnt/k/backup/Develop/code_scalpel_pro/`
- [ ] **Verify visibility** - Confirm repo is set as private on GitHub
- [ ] **Verify team access** - Only authorized engineers can access
- [ ] **Final structure:**
  ```
  code-scalpel-pro/
  â”œâ”€â”€ .github/workflows/
  â”œâ”€â”€ code_scalpel_pro/
  â”œâ”€â”€ tests/
  â”œâ”€â”€ docs/
  â”œâ”€â”€ metadata.json
  â”œâ”€â”€ pyproject.toml
  â”œâ”€â”€ README.md (internal only)
  â””â”€â”€ .gitignore
  ```
- [ ] **Set up branch protection:** `main` branch requires PR review
- [ ] **Configure private PyPI access** (see 1.3)

**Repository 3: code_scalpel_enterprise (Enterprise - Private)**
- [X] **Repository exists** - https://github.com/tescolopio/code_scalpel_enterprise.git
- [X] **Cloned locally** - `/mnt/k/backup/Develop/code_scalpel_enterprise/`
- [ ] **Verify visibility** - Confirm repo is set as private on GitHub
- [ ] **Verify team access** - Only authorized engineers can access
- [ ] **Final structure:**
  ```
  code-scalpel-enterprise/
  â”œâ”€â”€ .github/workflows/
  â”œâ”€â”€ code_scalpel_enterprise/
  â”œâ”€â”€ tests/
  â”œâ”€â”€ docs/
  â”œâ”€â”€ metadata.json
  â”œâ”€â”€ pyproject.toml
  â”œâ”€â”€ README.md (internal only)
  â””â”€â”€ .gitignore
  ```
- [ ] **Set up branch protection:** `main` branch requires PR review
- [ ] **Configure private PyPI access** (see 1.3)

#### 1.3: CI/CD Pipeline Configuration

**Public PyPI (Community Package)**

- [ ] **Create `.github/workflows/publish-pypi.yml`** in code-scalpel/
  - [ ] Triggers on tag push: `v4.0.0`
  - [ ] Builds wheel and sdist
  - [ ] Publishes to PyPI
  - [ ] Requires signed tags
- [ ] **Set PyPI API token** as GitHub secret: `PYPI_API_TOKEN`
- [ ] **Test workflow** with dry-run to PyPI test server
- [ ] **Document release process**: [Release Guide](docs/RELEASE.md)

**Private Enhancement Server (Pro/Enterprise Packages)**

- [ ] **Choose distribution method:**
  - [ ] Option A: GitHub Releases (private repo) with download script
  - [ ] Option B: Private PyPI server (e.g., Artifactory, Nexus)
  - [ ] Option C: S3 bucket with signed URLs
  - **Decision made:** __________________ (document choice)
- [ ] **Create enhancement package builder** (`.github/workflows/build-enhancement.yml`)
  - [ ] Builds wheel for Pro package
  - [ ] Builds wheel for Enterprise package
  - [ ] Generates SHA256 checksums
  - [ ] Uploads to chosen endpoint
  - [ ] Updates version API
- [ ] **Set up authentication:**
  - [ ] Generate auth tokens for downloads
  - [ ] Store in GitHub Secrets
  - [ ] Document for CLI enhancement_manager.py

#### 1.4: License & Documentation Setup

- [ ] **Community license selected:** __________________ (MIT/Apache 2.0/GPL)
  - [ ] [ ] Add LICENSE file to code-scalpel/
  - [ ] [ ] Add COPYING.md explaining commercial vs community
- [ ] **Pro/Enterprise licensing docs** created
  - [ ] [ ] Licensing model explained
  - [ ] [ ] Commercial terms documented internally
- [ ] **Create SECURITY.md** for code-scalpel/
  - [ ] [ ] Responsible disclosure policy
  - [ ] [ ] Security contact email
- [ ] **Create CONTRIBUTING.md** for code-scalpel/
  - [ ] [ ] CLA requirement (if applicable)
  - [ ] [ ] Code review process
  - [ ] [ ] Testing requirements

## Phase 2: Code Extraction & Community Package Assembly

**Timeline:** Week 2-3 | **Status:** â¬œ Not Started

### File Organization Checklist

#### 2.1: Directory Structure Creation

**Community Package Structure**
```
code-scalpel/
â”œâ”€â”€ src/code_scalpel/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ mcp/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ server.py              # ALL 22 tools, Community limits
â”‚   â”‚   â”œâ”€â”€ contract.py            # Unchanged
â”‚   â”‚   â”œâ”€â”€ enhancement_loader.py  # NEW
â”‚   â”‚   â”œâ”€â”€ response_config.py     # Unchanged
â”‚   â”‚   â””â”€â”€ tools/                 # Community-only tool implementations
â”‚   â”œâ”€â”€ licensing/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ jwt_validator.py       # Unchanged
â”‚   â”‚   â”œâ”€â”€ features.py            # Community features only (NEW)
â”‚   â”‚   â”œâ”€â”€ enhancement_manager.py # NEW - Downloads Pro/Enterprise
â”‚   â”‚   â”œâ”€â”€ config_loader.py       # Unchanged
â”‚   â”‚   â””â”€â”€ tiers.py               # NEW - Tier definitions
â”‚   â”œâ”€â”€ analysis/                  # Unchanged
â”‚   â”œâ”€â”€ code_parsers/              # Unchanged
â”‚   â”œâ”€â”€ graph_engine/              # Unchanged (basic version)
â”‚   â”œâ”€â”€ security/                  # Unchanged (basic version)
â”‚   â”œâ”€â”€ surgery/                   # Unchanged (basic version)
â”‚   â””â”€â”€ utilities/                 # Unchanged
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_community_features.py # NEW
â”‚   â”œâ”€â”€ test_enhancement_loader.py # NEW
â”‚   â”œâ”€â”€ test_tools_community_limits.py # NEW
â”‚   â””â”€â”€ [existing tests]
â”œâ”€â”€ docs/
â”œâ”€â”€ examples/
â”œâ”€â”€ pyproject.toml (modified)
â”œâ”€â”€ README.md (modified)
â”œâ”€â”€ LICENSE
â””â”€â”€ .gitignore
```

- [ ] **Create directory structure** in code-scalpel repository
- [ ] **Verify paths:** `find src/ -type d | sort`

#### 2.2: Identify & Catalog Pro/Enterprise Code

Create a file: `docs/CODE_INVENTORY.md`
- [ ] **List all Pro-only features** with file locations
  - [ ] Example: "code_smells detection" â†’ `src/code_scalpel/analysis/code_smells.py`
  - [ ] Complete inventory: [Document in CODE_INVENTORY.md]
- [ ] **List all Enterprise-only features** with file locations
  - [ ] Example: "Governance module" â†’ `src/code_scalpel/governance/`
  - [ ] Complete inventory: [Document in CODE_INVENTORY.md]
- [ ] **Map features to MCP tools** - Which tools get enhanced at each tier
- [ ] **Review for cross-references** - Ensure Pro code doesn't leak into Community base

#### 2.3: Create Enhancement Loader Infrastructure

**File: `src/code_scalpel/mcp/enhancement_loader.py`** (NEW)
- [ ] **Function: `load_enhancements(tier: str, path: Path) -> dict`**
  - [ ] Dynamically imports modules from enhancement package
  - [ ] Returns capabilities dict
  - [ ] Error handling for missing/corrupt enhancements
  - [ ] Logging for debugging
- [ ] **Function: `get_enhancement_capabilities(tier: str) -> dict`**
  - [ ] Loads metadata.json from enhancement package
  - [ ] Returns capability definitions
- [ ] **Function: `merge_tool_capabilities(base: dict, enhancement: dict) -> dict`**
  - [ ] Deep merges community + enhancement capabilities
  - [ ] Version compatibility checking
  - [ ] Conflict resolution logic
- [ ] **Function: `validate_enhancement_compatibility(tier: str, version: str) -> bool`**
  - [ ] Checks metadata.json compatible_core_versions
  - [ ] Compares against core server version
- [ ] **Testing:**
  - [ ] Unit tests for each function
  - [ ] Mock enhancement packages for testing
  - [ ] Error case coverage

**File: `src/code_scalpel/licensing/enhancement_manager.py`** (NEW)
- [ ] **Function: `download_enhancement_package(tier: str, auth_token: str) -> Path`**
  - [ ] Construct download URL from metadata
  - [ ] Use JWT token for authentication
  - [ ] Handle retries/timeouts
  - [ ] Progress reporting for user feedback
  - [ ] Returns path to downloaded package
- [ ] **Function: `verify_enhancement_integrity(path: Path, checksum: str) -> bool`**
  - [ ] SHA256 verification
  - [ ] Report tampering/corruption
  - [ ] Clean up on failure
- [ ] **Function: `extract_enhancement(archive: Path, target_dir: Path) -> bool`**
  - [ ] Unzip/wheel extraction
  - [ ] Permission handling
  - [ ] Backup existing enhancements
- [ ] **Function: `check_for_updates(tier: str) -> Optional[str]`**
  - [ ] Calls version API endpoint
  - [ ] Compares local vs available versions
  - [ ] Returns new version if available
- [ ] **Offline Mode:**
  - [ ] [ ] Support manual .whl file placement in ~/.code-scalpel/enhancements/{tier}/
  - [ ] [ ] Validate & extract manually placed files
- [ ] **Testing:**
  - [ ] Mock download server
  - [ ] Test checksum verification
  - [ ] Test extraction logic
  - [ ] Test version checking

**File: `src/code_scalpel/licensing/tiers.py`** (NEW)
- [ ] **Tier definitions with capabilities structure**
  ```python
  COMMUNITY_TIER = {
      "name": "community",
      "tools": {
          "analyze_code": {"max_file_size_mb": 1, "max_findings": 50},
          "extract_code": {"cross_file": False},
          # ... all 22 tools with limits
      }
  }
  
  PRO_TIER = {
      "name": "pro",
      "tools": {
          # Enhanced limits/features
      }
  }
  ```
- [ ] **Capability merging logic**
- [ ] **Documentation of all limits**

#### 2.4: Server Startup Modification

**File: `src/code_scalpel/mcp/server.py`** (MAJOR MODIFICATION)

- [ ] **Extract monolith into sections:**
  - [ ] Copy monolith as backup: `server.py.backup`
  - [ ] Review full file structure: `grep -n "^def " server.py`
  - [ ] Identify tool handlers (all 22)
  - [ ] Identify utility functions

- [ ] **Modify server startup function:**

  ```python
  async def main():
      # 1. Load community tier (base)
      community_tier = load_community_tier()
      
      # 2. Validate license
      license_data = validate_jwt_license()  # "community", "pro", "enterprise"
      effective_tier = license_data.get("tier", "community")
      
      # 3. Load enhancements if licensed
      enhancements = {}
      if effective_tier in ["pro", "enterprise"]:
          enhancement_path = get_enhancement_path(effective_tier)
          if not enhancement_path.exists():
              # Download and extract
              download_enhancement_package(effective_tier, license_data["download_token"])
          enhancements = load_enhancements(effective_tier, enhancement_path)
      
      # 4. Merge capabilities
      tool_capabilities = merge_tool_capabilities(community_tier, enhancements)
      
      # 5. Register all 22 tools with merged capabilities
      register_all_tools(tool_capabilities)
      
      # 6. Start MCP server
      async_server = create_mcp_server()
      # ... existing startup code
  ```
  
- [ ] **Strip out Pro/Enterprise logic from tool handlers:**
  - [ ] Example: In `analyze_code`, remove Pro-specific features
  - [ ] Keep only Community tier implementation
  - [ ] Comments indicating where Pro/Enterprise code was removed
  
- [ ] **All 22 tool handlers remain (not deleted):**
  - [ ] Ensure tool list: [document count]
  - [ ] Each tool configured with Community limits from tiers.py

- [ ] **Logging for enhancement loading:**
  - [ ] Log successful license validation
  - [ ] Log enhancement download attempts
  - [ ] Log enhancement load success/failure
  - [ ] Debug info accessible via --verbose flag

- [ ] **Error handling:**
  - [ ] Enhancement download failure â†’ fallback to Community
  - [ ] Corrupted enhancement â†’ warning, use Community
  - [ ] Missing license â†’ Community mode
  - [ ] Clear error messages for debugging

#### 2.5: License Validation & Configuration

**File: `src/code_scalpel/licensing/jwt_validator.py`** (MODIFICATION)
- [ ] **Ensure JWT includes:**
  - [ ] `tier: "community" | "pro" | "enterprise"`
  - [ ] `download_token: str` (for authenticated downloads)
  - [ ] `expiration: timestamp`
  - [ ] `issued_at: timestamp`
- [ ] **No changes required** - already supports this

**File: `src/code_scalpel/licensing/config_loader.py`** (MODIFICATION)
- [ ] **Add configuration for:**
  - [ ] Enhancement download endpoint (URL)
  - [ ] Fallback download URLs (CDN)
  - [ ] Cache directory location
  - [ ] Update check frequency
- [ ] **Load from:**
  - [ ] `~/.code-scalpel/config/limits.toml`
  - [ ] Environment variables (for CI/CD)

#### 2.6: CLI Initialization Command

**File: `src/code_scalpel/cli.py`** (NEW)
- [ ] **Command: `code-scalpel init`**
  - [ ] Creates `~/.code-scalpel/` directory structure
  - [ ] Creates subdirectories: license/, enhancements/, config/, cache/
  - [ ] Generates `config/limits.toml` with defaults
  - [ ] Prints instructions for license placement
  - [ ] Example output:
    ```
    âœ“ Created ~/.code-scalpel/
    
    Next steps:
    1. Save your license.jwt to: ~/.code-scalpel/license/license.jwt
    2. Restart your MCP server (restart VS Code)
    3. Enhanced capabilities will download automatically
    
    For support: https://code-scalpel.com/support
    ```

- [ ] **Command: `code-scalpel --diagnose`** (NEW)
  - [ ] Prints diagnostic information:
    ```
    Code Scalpel Diagnostic Report
    ================================
    Core: 4.0.0 âœ“
    License: Pro (valid until 2025-12-31) âœ“
    Enhancements: Pro 4.0.0 downloaded âœ“
    Tools: ALL 22 tools with Pro capabilities âœ“
    ```
  - [ ] Includes enhancement status
  - [ ] License validity
  - [ ] Download logs (last 10 lines)

#### 2.7: Community Features File

**File: `src/code_scalpel/licensing/features.py`** (MODIFICATION)
- [ ] **Define ALL 22 tools with Community limits:**
  ```python
  COMMUNITY_CAPABILITIES = {
      "analyze_code": {
          "max_file_size_mb": 1,
          "max_findings": 50,
          "features": ["ast", "basic_metrics"]
      },
      "get_file_context": {
          "max_file_size_mb": 1,
          "max_symbols": 100
      },
      # ... continue for all 22 tools
  }
  ```
- [ ] **Remove all Pro/Enterprise definitions**
- [ ] **Add capability merging function:**
  ```python
  def merge_capabilities(community, enhancement):
      # Deep merge with enhancement overriding community
  ```
- [ ] **Document all Community tier limits** in docstring

### Code Extraction Verification Checklist

#### 2.8: Extract & Verify Each Tool

For each of the 22 MCP tools, complete:

**Tools 1-5:**
- [ ] **analyze_code**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **get_file_context**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **get_project_map**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **get_symbol_references**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **crawl_project**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“

**Tools 6-10:**
- [ ] **get_call_graph**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **get_cross_file_dependencies**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **get_graph_neighborhood**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **scan_dependencies**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **security_scan**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“

**Tools 11-15:**
- [ ] **extract_code**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **update_symbol**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **rename_symbol**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **simulate_refactor**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **type_evaporation_scan**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“

**Tools 16-22:**
- [ ] **unified_sink_detect**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **validate_paths**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **symbolic_execute**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **generate_unit_tests**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **code_policy_check**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **verify_policy_integrity**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“
- [ ] **cross_file_security_scan**
  - [ ] Handler extracted: Lines XXX-YYY
  - [ ] Pro/Enterprise code identified: [locations]
  - [ ] Pro/Enterprise code removed: [confirm]
  - [ ] Community-only version compiles: âœ“

#### 2.9: Test Community Package in Isolation

- [ ] **Create test script:** `test_community_only.sh`
  ```bash
  # Install only code-scalpel (no Pro/Enterprise)
  pip install -e code-scalpel/
  
  # Run without any license
  python -c "from code_scalpel.mcp import server; print('Community OK')"
  
  # Start server and test all 22 tools with Community limits
  pytest tests/test_community_features.py -v
  ```

- [ ] **Run all Community tests:**
  ```bash
  cd code-scalpel/
  pytest tests/ -k community -v --cov
  ```

- [ ] **Verify Community test coverage >= 94%**
  - [ ] Generate report: `pytest --cov-report=html`
  - [ ] Review: `htmlcov/index.html`

- [ ] **Test MCP server startup:**
  ```bash
  code-scalpel init
  # Server starts with no license
  uvx code-scalpel --version
  # Should show: code-scalpel 4.0.0 (Community)
  ```

#### 2.10: Update Documentation

- [ ] **docs/INSTALLATION.md** - Community tier installation
- [ ] **docs/USAGE.md** - Using Community tools
- [ ] **docs/LICENSING.md** - License tiers explanation
- [ ] **docs/UPGRADE.md** - How to upgrade to Pro/Enterprise
- [ ] **README.md** - Updated for Community public release
- [ ] **CHANGELOG.md** - Document v4.0.0 breaking changes

## Phase 3: Pro Enhancement Package Creation

**Timeline:** Week 4-5 | **Status:** â¬œ Not Started

### Pro Package Structure & Extraction

#### 3.1: Repository Initialization

- [ ] **Clone code-scalpel-pro** (empty private repo)
  ```bash
  git clone https://github.com/yourbiz/code-scalpel-pro.git
  cd code-scalpel-pro
  ```

- [ ] **Create base structure:**
  ```
  code-scalpel-pro/
  â”œâ”€â”€ code_scalpel_pro/
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ capabilities.py
  â”‚   â”œâ”€â”€ tools/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â””â”€â”€ [enhancement modules]
  â”‚   â””â”€â”€ VERSION
  â”œâ”€â”€ tests/
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â””â”€â”€ test_pro_enhancements.py
  â”œâ”€â”€ docs/
  â”‚   â””â”€â”€ INTERNAL_README.md
  â”œâ”€â”€ metadata.json
  â”œâ”€â”€ pyproject.toml
  â”œâ”€â”€ build.py
  â””â”€â”€ .gitignore
  ```

#### 3.2: Pro Capabilities Definition

**File: `code_scalpel_pro/capabilities.py`** (NEW)
- [ ] **Extract from monolith:** All Pro-tier capability definitions
  - [ ] Search monolith: `grep -n "pro" src/code_scalpel/licensing/features.py`
  - [ ] Identify Pro limits for all 22 tools
  - [ ] Document source locations

- [ ] **Define PRO_CAPABILITIES dict:**
  ```python
  PRO_CAPABILITIES = {
      "tier": "pro",
      "version": "4.0.0",
      "tools": {
          "analyze_code": {
              "max_file_size_mb": 10,
              "max_findings": None,  # Unlimited
              "features": ["ast", "advanced_metrics", "code_smells", "halstead"]
          },
          # ... all 22 tools with Pro enhancements
      }
  }
  ```

- [ ] **Include all Pro-specific limits:**
  - [ ] Higher file size limits (1MB â†’ 10MB)
  - [ ] Increased analysis depth (3 â†’ 5)
  - [ ] Cross-file scope (50 â†’ 500 files)
  - [ ] Advanced features listed

#### 3.3: Pro Tool Enhancements

**Directory: `code_scalpel_pro/tools/`** (NEW MODULES)

For each of the 22 tools, extract Pro enhancements:

- [ ] **create enhancement module structure:**
  ```python
  # code_scalpel_pro/tools/analyze_code_pro.py
  
  def enhance_analyze_code(base_handler):
      """Wrap base handler with Pro capabilities."""
      async def pro_analyze_code(params):
          # Call base handler
          result = await base_handler(params)
          
          # Add Pro features:
          # - code_smells detection
          # - halstead metrics
          # - context-aware analysis
          # - higher limits
          
          return enhanced_result
      
      return pro_analyze_code
  ```

- [ ] **Identify Pro enhancements per tool:** (Create doc: `docs/PRO_ENHANCEMENTS_MAP.md`)
  ```
  Tool: analyze_code
  - Community: AST + basic metrics
  - Pro adds: Code smells, Halstead metrics, Complexity thresholds
  - Source in monolith: src/code_scalpel/analysis/code_smells.py (lines XXX-YYY)
  
  Tool: extract_code
  - Community: Single file extraction
  - Pro adds: Cross-file extraction (up to 500 files), dependency resolution
  - Source in monolith: src/code_scalpel/surgery/cross_file.py (lines XXX-YYY)
  
  [Continue for all 22 tools]
  ```

- [ ] **Extract Pro modules from monolith:**
  - [ ] `analyze_code_enhancements.py` - Code smells, advanced metrics
  - [ ] `extract_code_enhancements.py` - Cross-file extraction
  - [ ] `security_enhancements.py` - Advanced vulnerability detection
  - [ ] `graph_enhancements.py` - Advanced graph operations
  - [ ] `analysis_enhancements.py` - Advanced code analysis
  - [ ] `tools_init.py` - Enhancement registry

- [ ] **Tools Enhancement Registration:**
  ```python
  # code_scalpel_pro/tools/__init__.py
  
  from .analyze_code_pro import enhance_analyze_code
  from .extract_code_pro import enhance_extract_code
  # ... import all 22 tool enhancements
  
  TOOL_ENHANCEMENTS = {
      "analyze_code": enhance_analyze_code,
      "extract_code": enhance_extract_code,
      # ... all 22 tools
  }
  ```

#### 3.4: Pro Package Metadata

**File: `code_scalpel_pro/metadata.json`** (NEW)
- [ ] **Create metadata for enhancement downloads:**
  ```json
  {
    "name": "code-scalpel-pro",
    "version": "4.0.0",
    "compatible_core_versions": [">=4.0.0,<5.0.0"],
    "requires_tier": "pro",
    "requires_license_key": true,
    "download_url": "https://enhancements.code-scalpel.com/pro/{version}/",
    "checksum_algorithm": "sha256",
    "checksum": "abc123...",
    "dependencies": []
  }
  ```

**File: `code_scalpel_pro/pyproject.toml`** (NEW)
- [ ] **Create build configuration:**
  ```toml
  [build-system]
  requires = ["setuptools", "wheel"]
  build-backend = "setuptools.build_meta"
  
  [project]
  name = "code-scalpel-pro"
  version = "4.0.0"
  description = "Pro tier enhancements for Code Scalpel"
  requires-python = ">=3.10"
  dependencies = []  # No runtime dependencies
  
  [project.urls]
  Repository = "https://github.com/yourbiz/code-scalpel-pro"
  ```

**File: `code_scalpel_pro/__init__.py`** (NEW)
- [ ] **Package initialization:**
  ```python
  """Code Scalpel Pro tier enhancements."""
  
  __version__ = "4.0.0"
  
  from .capabilities import PRO_CAPABILITIES
  from .tools import TOOL_ENHANCEMENTS
  
  __all__ = ["PRO_CAPABILITIES", "TOOL_ENHANCEMENTS"]
  ```

#### 3.5: Pro Build & Distribution

**File: `code_scalpel_pro/build.py`** (NEW)
- [ ] **Create build script:**
  ```python
  import subprocess
  import hashlib
  import json
  from pathlib import Path
  
  def build_wheel():
      """Build wheel package."""
      result = subprocess.run(
          ["python", "-m", "build", "--wheel"],
          cwd=Path(__file__).parent
      )
      return result.returncode == 0
  
  def generate_checksum(wheel_path):
      """Generate SHA256 checksum."""
      with open(wheel_path, "rb") as f:
          return hashlib.sha256(f.read()).hexdigest()
  
  def update_metadata(checksum):
      """Update metadata.json with checksum."""
      with open("metadata.json") as f:
          metadata = json.load(f)
      
      metadata["checksum"] = checksum
      
      with open("metadata.json", "w") as f:
          json.dump(metadata, f, indent=2)
  
  if __name__ == "__main__":
      if build_wheel():
          wheel_file = list(Path("dist").glob("*.whl"))[0]
          checksum = generate_checksum(wheel_file)
          update_metadata(checksum)
          print(f"âœ“ Built: {wheel_file}")
          print(f"âœ“ Checksum: {checksum}")
      else:
          print("âœ— Build failed")
          exit(1)
  ```

- [ ] **Build script executable:** `chmod +x build.py`

#### 3.6: Pro Package Testing

**File: `code_scalpel_pro/tests/test_pro_enhancements.py`** (NEW)
- [ ] **Test enhancement loading:**
  - [ ] [ ] Test capabilities dict structure
  - [ ] [ ] Test metadata.json validity
  - [ ] [ ] Test tool enhancement registry
  - [ ] [ ] Test version compatibility checking

- [ ] **Test each Pro enhancement:**
  - [ ] [ ] analyze_code enhancements
  - [ ] [ ] extract_code enhancements
  - [ ] [ ] All 22 tool enhancements

- [ ] **Test integration with Community base:**
  - [ ] [ ] Load Community + Pro together
  - [ ] [ ] Verify capability merging
  - [ ] [ ] Test that Pro enhancements augment Community

- [ ] **Run Pro tests:**
  ```bash
  cd code-scalpel-pro/
  pytest tests/ -v --cov
  ```
  - [ ] Coverage >= 90%

#### 3.7: Pro Documentation

- [ ] **docs/INTERNAL_README.md** - Internal team documentation
  - [ ] [ ] Architecture overview
  - [ ] [ ] How enhancements work
  - [ ] [ ] Adding new enhancements
  - [ ] [ ] Release process
  - [ ] [ ] Security considerations

- [ ] **docs/PRO_FEATURES.md** - Feature documentation (for marketing)
  - [ ] [ ] List all Pro features
  - [ ] [ ] Limits comparison (Community vs Pro)
  - [ ] [ ] Use cases

#### 3.8: Pro Package CI/CD

**File: `.github/workflows/build-pro-enhancement.yml`** (NEW)
- [ ] **Create build workflow:**
  - [ ] Triggers on tag: `v4.0.0`
  - [ ] Builds wheel
  - [ ] Generates checksum
  - [ ] Uploads to private enhancement server
  - [ ] Updates version API
  - [ ] Notifies team of successful release

- [ ] **Private PyPI/Enhancement Server:**
  - [ ] [ ] Choose endpoint (GitHub Packages/Artifactory/custom)
  - [ ] [ ] Configure authentication
  - [ ] [ ] Set up download endpoint

#### 3.9: Integration with Community Package

- [ ] **Test enhancement loading in Community base:**
  ```python
  # In code-scalpel/tests/test_pro_integration.py
  from code_scalpel.licensing.enhancement_loader import load_enhancements
  
  def test_load_pro_enhancement_mock():
      # Mock Pro package
      pro_capabilities = load_enhancements("pro", mock_path)
      assert pro_capabilities["tier"] == "pro"
      assert len(pro_capabilities["tools"]) == 22
  ```

- [ ] **Test capability merging:**
  ```python
  from code_scalpel.licensing.features import merge_capabilities
  
  def test_merge_pro_capabilities():
      community = COMMUNITY_CAPABILITIES
      pro = PRO_CAPABILITIES
      merged = merge_capabilities(community, pro)
      
      # Pro limits should override Community
      assert merged["tools"]["analyze_code"]["max_file_size_mb"] == 10
  ```

- [ ] **Test all 22 tools with Pro capabilities loaded**

## Phase 4: Enterprise Enhancement Package Creation

**Timeline:** Week 6-7 | **Status:** â¬œ Not Started

### Enterprise Package Structure & Extraction

#### 4.1: Repository Initialization

- [ ] **Clone code-scalpel-enterprise** (empty private repo)
  ```bash
  git clone https://github.com/yourbiz/code-scalpel-enterprise.git
  cd code-scalpel-enterprise
  ```

- [ ] **Create base structure:**
  ```
  code-scalpel-enterprise/
  â”œâ”€â”€ code_scalpel_enterprise/
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ capabilities.py
  â”‚   â”œâ”€â”€ tools/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â””â”€â”€ [enhancement modules]
  â”‚   â”œâ”€â”€ governance/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â”œâ”€â”€ opa_engine.py
  â”‚   â”‚   â”œâ”€â”€ policy_loader.py
  â”‚   â”‚   â””â”€â”€ audit_logger.py
  â”‚   â”œâ”€â”€ policy_engine/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â””â”€â”€ [OPA integration modules]
  â”‚   â”œâ”€â”€ autonomy/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â””â”€â”€ [autonomy feature modules]
  â”‚   â””â”€â”€ VERSION
  â”œâ”€â”€ tests/
  â”‚   â”œâ”€â”€ test_enterprise_enhancements.py
  â”‚   â”œâ”€â”€ test_governance.py
  â”‚   â””â”€â”€ test_compliance.py
  â”œâ”€â”€ docs/
  â”‚   â””â”€â”€ INTERNAL_README.md
  â”œâ”€â”€ metadata.json
  â”œâ”€â”€ pyproject.toml
  â”œâ”€â”€ build.py
  â””â”€â”€ .gitignore
  ```

#### 4.2: Enterprise Capabilities Definition

**File: `code_scalpel_enterprise/capabilities.py`** (NEW)
- [ ] **Extract from monolith:** All Enterprise-tier capability definitions
  - [ ] Search monolith: `grep -n "enterprise" src/code_scalpel/licensing/features.py`
  - [ ] Identify Enterprise limits for all 22 tools
  - [ ] Document source locations

- [ ] **Define ENTERPRISE_CAPABILITIES dict:**
  ```python
  ENTERPRISE_CAPABILITIES = {
      "tier": "enterprise",
      "version": "4.0.0",
      "tools": {
          "analyze_code": {
              "max_file_size_mb": 100,
              "max_findings": None,  # Unlimited
              "features": ["ast", "advanced_metrics", "code_smells", "halstead", 
                          "custom_rules", "compliance_checks", "priority_ordering"]
          },
          # ... all 22 tools with Enterprise enhancements
      }
  }
  ```

- [ ] **Include all Enterprise-specific capabilities:**
  - [ ] Unlimited file size limits
  - [ ] Unlimited analysis depth
  - [ ] Unlimited cross-file scope
  - [ ] Custom rule support
  - [ ] Compliance audit features
  - [ ] Governance features

#### 4.3: Enterprise Tool Enhancements

**Directory: `code_scalpel_enterprise/tools/`** (NEW MODULES)

- [ ] **Create enhancement modules:**
  ```python
  # code_scalpel_enterprise/tools/analyze_code_enterprise.py
  
  def enhance_analyze_code(base_handler, pro_handler=None):
      """Wrap base/Pro handler with Enterprise capabilities."""
      async def enterprise_analyze_code(params):
          # Call Pro handler if available, else base handler
          if pro_handler:
              result = await pro_handler(params)
          else:
              result = await base_handler(params)
          
          # Add Enterprise features:
          # - Custom rules
          # - Compliance checks
          # - Priority ordering
          # - Unlimited limits
          # - Governance integration
          
          return enhanced_result
      
      return enterprise_analyze_code
  ```

- [ ] **Extract Enterprise enhancements per tool:** (Create doc: `docs/ENTERPRISE_ENHANCEMENTS_MAP.md`)
  ```
  Tool: analyze_code
  - Pro: Code smells, Halstead metrics
  - Enterprise adds: Custom analysis rules, Compliance frameworks (HIPAA/SOC2), Priority scoring
  - Source in monolith: src/code_scalpel/governance/compliance.py (lines XXX-YYY)
  
  Tool: code_policy_check
  - Pro: Basic and best practice rules
  - Enterprise adds: Full compliance audit (HIPAA/SOC2/GDPR/PCI-DSS), custom policies, PDF reporting
  - Source in monolith: src/code_scalpel/governance/compliance_audit.py (lines XXX-YYY)
  
  [Continue for all 22 tools]
  ```

#### 4.4: Enterprise Governance Module

**Directory: `code_scalpel_enterprise/governance/`** (NEW)

- [ ] **File: `code_scalpel_enterprise/governance/opa_engine.py`** (NEW)
  - [ ] OPA (Open Policy Agent) integration
  - [ ] Policy loading and compilation
  - [ ] Decision evaluation
  - [ ] Audit logging of all decisions

- [ ] **File: `code_scalpel_enterprise/governance/policy_loader.py`** (NEW)
  - [ ] Load organization policies
  - [ ] Policy validation
  - [ ] Version management
  - [ ] Hot reload support

- [ ] **File: `code_scalpel_enterprise/governance/audit_logger.py`** (NEW)
  - [ ] Log all analysis operations
  - [ ] Track policy decisions
  - [ ] Generate audit reports
  - [ ] HIPAA/SOC2 compliance logging

#### 4.5: Enterprise Policy Engine

**Directory: `code_scalpel_enterprise/policy_engine/`** (NEW)

- [ ] **File: `code_scalpel_enterprise/policy_engine/compliance_rules.py`** (NEW)
  - [ ] HIPAA compliance rules
  - [ ] SOC2 compliance rules
  - [ ] GDPR compliance rules
  - [ ] PCI-DSS compliance rules
  - [ ] Custom rule framework

- [ ] **File: `code_scalpel_enterprise/policy_engine/pdf_reporter.py`** (NEW)
  - [ ] Generate PDF compliance reports
  - [ ] Executive summary
  - [ ] Detailed findings
  - [ ] Remediation recommendations
  - [ ] Audit trail documentation

#### 4.6: Enterprise Autonomy Features

**Directory: `code_scalpel_enterprise/autonomy/`** (NEW)

- [ ] **File: `code_scalpel_enterprise/autonomy/agent_controller.py`** (NEW)
  - [ ] Autonomous agent orchestration
  - [ ] Decision tracking
  - [ ] Rollback capabilities
  - [ ] Audit trail for autonomous actions

- [ ] **File: `code_scalpel_enterprise/autonomy/budgeting.py`** (NEW)
  - [ ] Change budgeting system
  - [ ] Risk assessment
  - [ ] Approval workflows

#### 4.7: Enterprise Package Metadata

**File: `code_scalpel_enterprise/metadata.json`** (NEW)
- [ ] **Create metadata with Pro dependency:**
  ```json
  {
    "name": "code-scalpel-enterprise",
    "version": "4.0.0",
    "compatible_core_versions": [">=4.0.0,<5.0.0"],
    "requires_tier": "enterprise",
    "requires_license_key": true,
    "dependencies": ["code-scalpel-pro==4.0.0"],
    "download_url": "https://enhancements.code-scalpel.com/enterprise/{version}/",
    "checksum_algorithm": "sha256",
    "checksum": "def456...",
    "features": ["governance", "compliance_audit", "autonomy"]
  }
  ```

**File: `code_scalpel_enterprise/pyproject.toml`** (NEW)
- [ ] **Create build configuration:**
  ```toml
  [build-system]
  requires = ["setuptools", "wheel"]
  build-backend = "setuptools.build_meta"
  
  [project]
  name = "code-scalpel-enterprise"
  version = "4.0.0"
  description = "Enterprise tier enhancements for Code Scalpel"
  requires-python = ">=3.10"
  dependencies = []  # No runtime dependencies (bundled at download time)
  ```

**File: `code_scalpel_enterprise/__init__.py`** (NEW)
- [ ] **Package initialization:**
  ```python
  """Code Scalpel Enterprise tier enhancements."""
  
  __version__ = "4.0.0"
  
  from .capabilities import ENTERPRISE_CAPABILITIES
  from .tools import TOOL_ENHANCEMENTS
  from .governance import GOVERNANCE_MODULES
  
  __all__ = ["ENTERPRISE_CAPABILITIES", "TOOL_ENHANCEMENTS", "GOVERNANCE_MODULES"]
  ```

#### 4.8: Enterprise Build & Distribution

**File: `code_scalpel_enterprise/build.py`** (NEW)
- [ ] **Create build script** (similar to Pro, but adds dependency handling)
  - [ ] Verify Pro enhancement availability
  - [ ] Download Pro package during build (for bundling)
  - [ ] Build Enterprise wheel
  - [ ] Include Pro in metadata.json
  - [ ] Generate checksums

#### 4.9: Enterprise Package Testing

**File: `code_scalpel_enterprise/tests/test_enterprise_enhancements.py`** (NEW)
- [ ] **Test enhancement loading:**
  - [ ] [ ] Test capabilities dict structure
  - [ ] [ ] Test metadata.json validity
  - [ ] [ ] Test Pro dependency declaration
  - [ ] [ ] Test version compatibility checking

**File: `code_scalpel_enterprise/tests/test_governance.py`** (NEW)
- [ ] **Test governance features:**
  - [ ] [ ] OPA policy loading
  - [ ] [ ] Policy decision evaluation
  - [ ] [ ] Audit logging
  - [ ] [ ] Custom policy support

**File: `code_scalpel_enterprise/tests/test_compliance.py`** (NEW)
- [ ] **Test compliance features:**
  - [ ] [ ] HIPAA rules validation
  - [ ] [ ] SOC2 rules validation
  - [ ] [ ] GDPR rules validation
  - [ ] [ ] PCI-DSS rules validation
  - [ ] [ ] PDF report generation

- [ ] **Run Enterprise tests:**
  ```bash
  cd code-scalpel-enterprise/
  pytest tests/ -v --cov
  ```
  - [ ] Coverage >= 90%

#### 4.10: Enterprise Documentation

- [ ] **docs/INTERNAL_README.md** - Internal team documentation
  - [ ] [ ] Architecture overview
  - [ ] [ ] Governance system
  - [ ] [ ] Compliance features
  - [ ] [ ] Autonomy features
  - [ ] [ ] Release process

- [ ] **docs/ENTERPRISE_FEATURES.md** - Feature documentation (for marketing)
  - [ ] [ ] List all Enterprise features
  - [ ] [ ] Compliance audit capabilities
  - [ ] [ ] Governance integration
  - [ ] [ ] Autonomy features
  - [ ] [ ] Use cases

#### 4.11: Enterprise CI/CD

**File: `.github/workflows/build-enterprise-enhancement.yml`** (NEW)
- [ ] **Create build workflow:**
  - [ ] Triggers on tag: `v4.0.0`
  - [ ] Downloads Pro enhancement (for bundling verification)
  - [ ] Builds wheel
  - [ ] Generates checksum
  - [ ] Uploads to private enhancement server
  - [ ] Updates version API
  - [ ] Notifies team of successful release

#### 4.12: Integration with Community & Pro Packages

- [ ] **Test enhancement loading with Pro dependency:**
  ```python
  # In code-scalpel/tests/test_enterprise_integration.py
  from code_scalpel.licensing.enhancement_loader import load_enhancements
  
  def test_load_enterprise_with_pro_dependency():
      # Mock Pro + Enterprise packages
      # Verify Pro loads first, then Enterprise
      pro_caps = load_enhancements("pro", mock_pro_path)
      ent_caps = load_enhancements("enterprise", mock_ent_path)
      
      assert pro_caps["tier"] == "pro"
      assert ent_caps["tier"] == "enterprise"
      assert "code-scalpel-pro==4.0.0" in ent_caps["dependencies"]
  ```

- [ ] **Test capability stacking:**
  ```python
  from code_scalpel.licensing.features import merge_capabilities
  
  def test_merge_community_pro_enterprise():
      community = COMMUNITY_CAPABILITIES
      pro = PRO_CAPABILITIES
      enterprise = ENTERPRISE_CAPABILITIES
      
      # Merge in order
      merged = merge_capabilities(community, pro)
      merged = merge_capabilities(merged, enterprise)
      
      # Enterprise limits should take precedence
      assert merged["tools"]["analyze_code"]["max_file_size_mb"] == 100
      assert merged["tools"]["code_policy_check"]["compliance_audit"] == True
  ```

- [ ] **Test all 22 tools with Enterprise capabilities loaded**
- [ ] **Test governance features work with all tools**
Phase 5: Testing & Documentation (Week 8)
Integration Testing:
Test all tier combinations (Community, Pro, Enterprise)
Test license validation with plugins
Test upgrade paths (Communityâ†’Pro, Proâ†’Enterprise)
Test version compatibility
Documentation Updates:
Installation instructions per tier
Plugin architecture guide
Migration guide for existing users
Troubleshooting guide
Release Preparation:
Tag all repositories: v4.0.0
Build packages
Test PyPI/private PyPI uploads
Prepare announcement
Phase 6: User Migration (Week 9-10)
Communication:
Email existing Pro/Enterprise customers
Explain automatic enhancement download system
Update license download portal with instructions:

# All users (no change):
1. Configure IDE with: uvx code-scalpel
2. (Pro/Enterprise) Place license.jwt in ~/.code-scalpel/license/
3. Restart MCP server
4. Enhancements auto-download on first boot
Migration Support:
No manual migration needed - automatic for MCP users
Python package users: Uninstall old, install 4.0.0
2-week support window for questions
Monitor enhancement download success rates
License Server Updates:
Update to issue v4.0.0+ compatible JWTs
Include download auth token in JWT claims
Add enhancement download endpoint
Version compatibility API
## Phase 5: Testing & Quality Assurance

**Timeline:** Week 8 | **Status:** â¬œ Not Started

### Integration Testing

#### 5.1: Test Environment Setup
- [ ] **Create test matrix document** - Testing scenarios
  | Tier | License | Installed | Expected Tools | Expected Limits |
  |------|---------|-----------|-----------------|-----------------|
  | Community | None | Community | 22 (basic) | Community |
  | Community | Pro (invalid) | Community | 22 (basic) | Community |
  | Pro | None | Community + Pro | 22 (enhanced) | Community |
  | Pro | Pro (valid) | Community + Pro | 22 (enhanced) | Pro |
  | Enterprise | None | Community + Pro + Ent | 22 (full) | Community |
  | Enterprise | Pro (valid) | Community + Pro + Ent | 22 (full) | Pro |
  | Enterprise | Enterprise (valid) | Community + Pro + Ent | 22 (full) | Enterprise |

- [ ] **Create test environment manifests:**
  - [ ] Environment 1: Community only (no license)
  - [ ] Environment 2: Community + Pro package (Pro license)
  - [ ] Environment 3: All three packages (Enterprise license)
  - [ ] Environment 4: Offline mode (manual enhancement installation)

#### 5.2: Community Tier Integration Tests
- [ ] **Test Community package in isolation** (no Pro/Enterprise)
  - [ ] [ ] `pytest tests/test_community_integration.py -v`
  - [ ] [ ] Test all 22 tools with Community limits
  - [ ] [ ] Verify Pro/Enterprise code is NOT available
  - [ ] [ ] Verify enhancement loader handles missing enhancements gracefully
  - [ ] [ ] Verify enhancement_manager.py doesn't cause errors

- [ ] **Test license validation:**
  - [ ] [ ] No license â†’ Community mode
  - [ ] [ ] Invalid JWT â†’ Community mode with warning
  - [ ] [ ] Expired license â†’ Community mode with warning

#### 5.3: Pro Tier Integration Tests
- [ ] **Test Pro enhancements load correctly:**
  - [ ] [ ] License valid â†’ downloads Pro enhancement
  - [ ] [ ] Downloaded Pro enhancement loads
  - [ ] [ ] All 22 tools operate with Pro capabilities
  - [ ] [ ] Pro limits enforced (10MB files, depth 5, etc.)

- [ ] **Test capability merging:**
  - [ ] [ ] Community base + Pro enhancements â†’ correct merged capabilities
  - [ ] [ ] Pro limits override Community limits
  - [ ] [ ] Pro features available (code_smells, halstead, etc.)

- [ ] **Test each Pro enhancement:**
  - [ ] [ ] analyze_code: code_smells, advanced_metrics
  - [ ] [ ] extract_code: cross-file extraction (up to 500 files)
  - [ ] [ ] All 22 tools enhanced correctly

- [ ] **Run Pro integration tests:**
  ```bash
  pytest tests/test_pro_integration.py -v
  ```

#### 5.4: Enterprise Tier Integration Tests
- [ ] **Test Enterprise enhancements load correctly:**
  - [ ] [ ] License valid (Enterprise) â†’ downloads Pro + Enterprise
  - [ ] [ ] Both Pro and Enterprise enhancements load
  - [ ] [ ] Dependency handling: Enterprise depends on Pro
  - [ ] [ ] All 22 tools operate with Enterprise capabilities

- [ ] **Test capability stacking:**
  - [ ] [ ] Community base + Pro + Enterprise â†’ correct stacked capabilities
  - [ ] [ ] Enterprise limits override Pro limits override Community limits
  - [ ] [ ] Enterprise features available (governance, compliance, autonomy)

- [ ] **Test governance features:**
  - [ ] [ ] Policy loading and validation
  - [ ] [ ] Decision evaluation with policies
  - [ ] [ ] Audit logging of all operations
  - [ ] [ ] Custom rule support

- [ ] **Test compliance audit features:**
  - [ ] [ ] HIPAA compliance checks
  - [ ] [ ] SOC2 compliance checks
  - [ ] [ ] GDPR compliance checks
  - [ ] [ ] PCI-DSS compliance checks
  - [ ] [ ] PDF report generation

- [ ] **Run Enterprise integration tests:**
  ```bash
  pytest tests/test_enterprise_integration.py -v
  ```

#### 5.5: Cross-Tier Upgrade Tests
- [ ] **Test Community â†’ Pro upgrade:**
  - [ ] [ ] Install Community only
  - [ ] [ ] Add Pro license
  - [ ] [ ] Restart server
  - [ ] [ ] Pro enhancements download + load automatically
  - [ ] [ ] All 22 tools upgraded to Pro capabilities
  - [ ] [ ] No manual steps required for user

- [ ] **Test Pro â†’ Enterprise upgrade:**
  - [ ] [ ] Have Pro enhancements downloaded
  - [ ] [ ] Add Enterprise license
  - [ ] [ ] Restart server
  - [ ] [ ] Enterprise enhancements download (+ Pro dependency verified)
  - [ ] [ ] All 22 tools upgraded to Enterprise capabilities
  - [ ] [ ] Both Pro and Enterprise loaded correctly

- [ ] **Test downgrade (Enterprise license expired):**
  - [ ] [ ] Have Enterprise enhancements loaded
  - [ ] [ ] License expires
  - [ ] [ ] Server falls back to Community mode
  - [ ] [ ] Tools still work with Community limits

#### 5.6: Version Compatibility Tests
- [ ] **Test version matching:**
  - [ ] [ ] metadata.json: compatible_core_versions checking
  - [ ] [ ] Pro v4.0.0 + Core v4.0.0 â†’ compatible
  - [ ] [ ] Pro v4.0.0 + Core v3.3.0 â†’ incompatible (error)
  - [ ] [ ] Pro v4.0.0 + Core v5.0.0 â†’ incompatible (error)

- [ ] **Test auto-download of compatible version:**
  - [ ] [ ] Core v4.0.1, Pro v4.1.0 available
  - [ ] [ ] License includes Pro
  - [ ] [ ] Server downloads Pro v4.1.0 (compatible with Core v4.0.1)

#### 5.7: Offline Mode Testing
- [ ] **Test manual enhancement placement:**
  - [ ] [ ] Manually place Pro wheel in `~/.code-scalpel/enhancements/pro/`
  - [ ] [ ] Server loads enhancement without download
  - [ ] [ ] All Pro capabilities work

- [ ] **Test invalid/corrupt enhancement handling:**
  - [ ] [ ] Corrupt .whl file â†’ server skips, uses Community
  - [ ] [ ] Checksum mismatch â†’ server skips, uses Community
  - [ ] [ ] Clear error message logged

#### 5.8: Test Coverage & Reporting
- [ ] **Run full test suite:**
  ```bash
  # Community package
  cd code-scalpel/
  pytest tests/ -v --cov --cov-report=html
  
  # Pro package
  cd code-scalpel-pro/
  pytest tests/ -v --cov --cov-report=html
  
  # Enterprise package
  cd code-scalpel-enterprise/
  pytest tests/ -v --cov --cov-report=html
  ```

- [ ] **Verify coverage thresholds:**
  - [ ] Community: >= 94% (maintain current level)
  - [ ] Pro: >= 90%
  - [ ] Enterprise: >= 90%

- [ ] **Generate coverage reports:**
  - [ ] [ ] Combine all coverage data
  - [ ] [ ] Create summary HTML report
  - [ ] [ ] Document any coverage gaps

#### 5.9: Security Testing
- [ ] **Test license validation security:**
  - [ ] [ ] Tampered JWT rejected
  - [ ] [ ] Signature verification works
  - [ ] [ ] No private key in Community code

- [ ] **Test enhancement download security:**
  - [ ] [ ] HTTPS-only downloads
  - [ ] [ ] SHA256 checksum verification
  - [ ] [ ] Certificate pinning (if applicable)

- [ ] **Test private code isolation:**
  - [ ] [ ] Pro code not in Community package
  - [ ] [ ] Enterprise code not in Community/Pro packages
  - [ ] [ ] No hardcoded credentials in any package
  - [ ] [ ] Code review for accidental secrets

#### 5.10: Performance Testing
- [ ] **Test enhancement loading overhead:**
  - [ ] [ ] Measure server startup time (no enhancement)
  - [ ] [ ] Measure server startup time (with Pro enhancement)
  - [ ] [ ] Measure server startup time (with Pro + Enterprise)
  - [ ] [ ] Target: < 100ms overhead per enhancement

- [ ] **Test tool performance with different tiers:**
  - [ ] [ ] analyze_code: Community vs Pro vs Enterprise
  - [ ] [ ] extract_code: Community vs Pro vs Enterprise
  - [ ] [ ] No performance regression at Community tier

### Documentation Checklist

#### 5.11: User Documentation
- [ ] **INSTALLATION.md**
  - [ ] Community tier installation
  - [ ] PyPI installation: `pip install code-scalpel`
  - [ ] MCP configuration: `uvx code-scalpel`
  - [ ] First-run setup: `code-scalpel init`

- [ ] **UPGRADE.md**
  - [ ] How to upgrade from Community to Pro
  - [ ] License placement instructions
  - [ ] Automatic enhancement download process
  - [ ] Troubleshooting common issues

- [ ] **LICENSING.md**
  - [ ] Tier comparison table
  - [ ] License types and costs
  - [ ] License key format
  - [ ] License expiration and renewal
  - [ ] Usage terms per tier

- [ ] **TROUBLESHOOTING.md**
  - [ ] "License not found" â†’ solution
  - [ ] "Enhancement download failed" â†’ solution
  - [ ] "Tools not available" â†’ solution
  - [ ] "Performance issues" â†’ solution
  - [ ] Support contact information

#### 5.12: Developer Documentation
- [ ] **docs/ARCHITECTURE.md** - Updated
  - [ ] Three-tier architecture
  - [ ] Enhancement download mechanism
  - [ ] Tool capability system
  - [ ] Capability merging logic

- [ ] **docs/DEVELOPMENT.md** - New
  - [ ] Setting up development environment
  - [ ] Running tests locally
  - [ ] Making changes to Community code
  - [ ] Adding Pro features (internal guide)
  - [ ] Contributing guidelines

- [ ] **docs/RELEASE.md** - New
  - [ ] Release process for each tier
  - [ ] Version numbering strategy
  - [ ] Building and publishing
  - [ ] Enhancement server updates
  - [ ] Customer communication template

#### 5.13: Internal Documentation
- [ ] **code-scalpel-pro/docs/INTERNAL_README.md**
  - [ ] Pro feature list
  - [ ] Enhancement module structure
  - [ ] Adding new Pro features
  - [ ] Testing Pro enhancements
  - [ ] Security considerations

- [ ] **code-scalpel-enterprise/docs/INTERNAL_README.md**
  - [ ] Enterprise feature list
  - [ ] Governance system architecture
  - [ ] Compliance framework
  - [ ] Autonomy features
  - [ ] Security considerations

## Phase 6: Release Preparation & Launch

**Timeline:** Week 9 | **Status:** â¬œ Not Started

### Build & Package Preparation

#### 6.1: Version & Tagging

- [ ] **Confirm version number:** v4.0.0 (breaking changes due to architecture split)
- [ ] **Tag monolith archive:**
  ```bash
  cd code-scalpel-monolith-archive
  git tag -a v3.3.0-final-monolith -m "Final monolithic release before clean break split"
  git push origin v3.3.0-final-monolith
  ```
- [ ] **Initialize all three repositories:**
  ```bash
  # code-scalpel
  cd code-scalpel
  git tag -a v4.0.0 -m "First split release - Community tier"
  git push origin v4.0.0
  
  # code-scalpel-pro
  cd code-scalpel-pro
  git tag -a v4.0.0 -m "First split release - Pro tier enhancements"
  git push origin v4.0.0
  
  # code-scalpel-enterprise
  cd code-scalpel-enterprise
  git tag -a v4.0.0 -m "First split release - Enterprise tier enhancements"
  git push origin v4.0.0
  ```

#### 6.2: PyPI Preparation (Community Package)

- [ ] **Build Community package:**
  ```bash
  cd code-scalpel/
  python -m build
  ```
  - [ ] Verify wheel: `dist/code_scalpel-4.0.0-py3-none-any.whl`
  - [ ] Verify source: `dist/code-scalpel-4.0.0.tar.gz`

- [ ] **Test PyPI upload (dry-run):**
  ```bash
  twine upload --repository testpypi dist/*
  ```
  - [ ] Verify on Test PyPI: https://test.pypi.org/project/code-scalpel/

- [ ] **Publish to production PyPI:**
  ```bash
  twine upload dist/*
  ```
  - [ ] Verify on PyPI: https://pypi.org/project/code-scalpel/

- [ ] **Test installation from PyPI:**
  ```bash
  pip install code-scalpel==4.0.0
  python -c "from code_scalpel import __version__; print(__version__)"
  ```
  - [ ] Should output: `4.0.0`

#### 6.3: Enhancement Server Setup (Pro/Enterprise)

- [ ] **Choose and configure enhancement server:**
  - [ ] [ ] GitHub Packages (private repo): Configure `.github/workflows/publish.yml`
  - [ ] [ ] Artifactory: Set up repository, API keys
  - [ ] [ ] Custom S3: Configure bucket, signed URLs
  - [ ] **Decision made & configured:** __________________

- [ ] **Generate authentication tokens:**
  - [ ] [ ] Create download auth tokens (JWT format)
  - [ ] [ ] Store securely (GitHub Secrets, Vault, etc.)
  - [ ] [ ] Document token generation process

- [ ] **Build Pro enhancement package:**
  ```bash
  cd code-scalpel-pro/
  python build.py
  ```
  - [ ] Verify wheel: `dist/code_scalpel_pro-4.0.0-py3-none-any.whl`
  - [ ] Verify checksum generated and metadata.json updated

- [ ] **Upload Pro to enhancement server:**
  - [ ] [ ] Manual upload to configured endpoint
  - [ ] [ ] Verify download URL works
  - [ ] [ ] Test download with auth token

- [ ] **Build Enterprise enhancement package:**
  ```bash
  cd code-scalpel-enterprise/
  python build.py
  ```
  - [ ] Verify wheel: `dist/code_scalpel_enterprise-4.0.0-py3-none-any.whl`
  - [ ] Verify checksum generated and metadata.json updated
  - [ ] Verify Pro dependency declared in metadata.json

- [ ] **Upload Enterprise to enhancement server:**
  - [ ] [ ] Manual upload to configured endpoint
  - [ ] [ ] Verify download URL works
  - [ ] [ ] Test download with auth token

#### 6.4: Version API Endpoint

- [ ] **Create version API endpoint** (used by enhancement_manager.py)
  - [ ] [ ] Endpoint: `GET /api/versions/{tier}/{version}/`
  - [ ] [ ] Returns latest compatible version
  - [ ] [ ] Returns download URL + checksum
  - [ ] [ ] Example response:
    ```json
    {
      "tier": "pro",
      "current_version": "4.0.0",
      "latest_version": "4.0.0",
      "download_url": "https://enhancements.code-scalpel.com/pro/4.0.0/code_scalpel_pro-4.0.0.whl",
      "checksum": "sha256:abc123...",
      "compatible_core_versions": [">=4.0.0,<5.0.0"]
    }
    ```

- [ ] **Implement health check endpoint:**
  - [ ] [ ] Endpoint: `GET /health/`
  - [ ] [ ] Returns 200 OK with status info
  - [ ] [ ] Used by enhancement_manager.py for connectivity check

#### 6.5: CI/CD Pipeline Verification

- [ ] **Community package CI/CD:**
  - [ ] [ ] Verify `.github/workflows/publish-pypi.yml` triggers on tag push
  - [ ] [ ] Verify workflow builds, tests, and publishes to PyPI
  - [ ] [ ] Run workflow manually to test

- [ ] **Pro enhancement CI/CD:**
  - [ ] [ ] Verify `.github/workflows/build-pro-enhancement.yml` triggers on tag push
  - [ ] [ ] Verify workflow builds wheel, generates checksum, uploads
  - [ ] [ ] Run workflow manually to test

- [ ] **Enterprise enhancement CI/CD:**
  - [ ] [ ] Verify `.github/workflows/build-enterprise-enhancement.yml` triggers on tag push
  - [ ] [ ] Verify workflow builds wheel, verifies Pro dependency, uploads
  - [ ] [ ] Run workflow manually to test

### Customer Communication

#### 6.6: Communication Materials

- [ ] **Draft announcement email** to existing customers:
  ```
  Subject: Exciting News: Code Scalpel v4.0.0 - The Split Release

  We're thrilled to announce Code Scalpel v4.0.0, a major architectural 
  change that brings:

  âœ“ Free Community Edition (all 22 tools!)
  âœ“ Faster releases (independent per tier)
  âœ“ Better security (private code in separate repos)
  âœ“ Same great Pro/Enterprise features

  No action required for existing Pro/Enterprise customers:
  - License placement: Same process (place JWT in ~/.code-scalpel/license/)
  - Enhancements: Auto-download on first boot
  - Tools: All 22 available with your licensed tier capabilities

  Installation: uvx code-scalpel

  Questions? See our migration guide: [link]
  ```

- [ ] **Create migration guide:** `docs/MIGRATION_v3_to_v4.md`
  - [ ] [ ] For Community users (first time): How to get started
  - [ ] [ ] For Pro customers: What changes, how to upgrade
  - [ ] [ ] For Enterprise customers: What changes, how to upgrade
  - [ ] [ ] FAQ section: Common questions and answers

- [ ] **Create blog post** (for marketing):
  - [ ] [ ] Title: "Introducing Code Scalpel v4.0.0: A New Era of Flexibility"
  - [ ] [ ] Sections:
    - [ ] Why the split?
    - [ ] What's the Community Edition?
    - [ ] What's different for Pro/Enterprise?
    - [ ] How does automatic enhancement download work?
    - [ ] No interruption to existing customers

#### 6.7: License & Legal Review

- [ ] **Legal review of Community license:**
  - [ ] [ ] MIT/Apache 2.0/GPL selected and reviewed
  - [ ] [ ] No conflicts with Pro/Enterprise terms
  - [ ] [ ] License.txt file in code-scalpel/ repo

- [ ] **Review commercialsoftware protection:**
  - [ ] [ ] Pro/Enterprise code not accidentally in Community package
  - [ ] [ ] GitHub private repo access restricted
  - [ ] [ ] No credentials/keys in any repo
  - [ ] [ ] Security audit of all three repositories

#### 6.8: Support & Troubleshooting Preparation

- [ ] **Create support FAQ:** `docs/SUPPORT.md`
  - [ ] [ ] "How do I install Code Scalpel 4.0?"
  - [ ] [ ] "How do I upgrade my license?"
  - [ ] [ ] "Enhancement download failed - what do I do?"
  - [ ] [ ] "Do I need to change my IDE configuration?"
  - [ ] [ ] "Can I use the old monolithic package?"

- [ ] **Create rollback plan** (if needed):
  - [ ] [ ] Document how to revert to v3.3.0
  - [ ] [ ] Keep v3.3.0 on PyPI available
  - [ ] [ ] Document in troubleshooting guide

- [ ] **Set up customer support channel:**
  - [ ] [ ] Email: support@code-scalpel.com
  - [ ] [ ] GitHub Discussions (public community)
  - [ ] [ ] Private email for Pro/Enterprise customers
  - [ ] [ ] Slack channel (if applicable)

### Final Checks Before Launch

#### 6.9: Pre-Launch Checklist

- [ ] **Code Quality:**
  - [ ] [ ] All tests passing (Community, Pro, Enterprise)
  - [ ] [ ] Code coverage >= 90% across all packages
  - [ ] [ ] No security warnings from automated scans
  - [ ] [ ] No lint/format issues

- [ ] **Documentation Quality:**
  - [ ] [ ] README.md updated and accurate
  - [ ] [ ] INSTALLATION.md complete
  - [ ] [ ] UPGRADE.md complete
  - [ ] [ ] API documentation generated
  - [ ] [ ] All links working (no 404s)

- [ ] **Package Quality:**
  - [ ] [ ] Community package on PyPI
  - [ ] [ ] Pro package on enhancement server
  - [ ] [ ] Enterprise package on enhancement server
  - [ ] [ ] All metadata.json files valid
  - [ ] [ ] All checksums valid

- [ ] **Functionality Testing:**
  - [ ] [ ] MCP server starts without license (Community mode)
  - [ ] [ ] MCP server starts with Pro license (Pro enhancements load)
  - [ ] [ ] MCP server starts with Enterprise license (All enhancements load)
  - [ ] [ ] All 22 tools work at each tier
  - [ ] [ ] Limits enforced correctly

- [ ] **Performance:**
  - [ ] [ ] Server startup < 5 seconds (Community)
  - [ ] [ ] Server startup < 6 seconds (Pro with enhancement download)
  - [ ] [ ] Server startup < 7 seconds (Enterprise with Pro + Enterprise)
  - [ ] [ ] No memory leaks detected

- [ ] **Security:**
  - [ ] [ ] JWT validation working
  - [ ] [ ] HTTPS enforcement on enhancement downloads
  - [ ] [ ] Checksum verification working
  - [ ] [ ] No secrets in source code
  - [ ] [ ] Private repos access restricted

#### 6.10: Rollout Plan

- [ ] **Week 1: Beta Release**
  - [ ] [ ] Tag v4.0.0-beta on all three repos
  - [ ] [ ] Publish Community to PyPI with "beta" in version
  - [ ] [ ] Enable Pro/Enterprise downloads (beta version API)
  - [ ] [ ] Announce to early access customers
  - [ ] [ ] Collect feedback

- [ ] **Week 2: Bug Fixes (if needed)**
  - [ ] [ ] Fix any reported issues
  - [ ] [ ] Tag v4.0.0-beta.2 (or v4.0.0-rc.1)
  - [ ] [ ] Test fixes
  - [ ] [ ] Second round of feedback

- [ ] **Week 3: General Availability**
  - [ ] [ ] Remove beta designation
  - [ ] [ ] Tag v4.0.0 final
  - [ ] [ ] Publish to PyPI (remove beta)
  - [ ] [ ] Release Pro/Enterprise v4.0.0 final
  - [ ] [ ] Send announcement to all customers
  - [ ] [ ] Update website/docs to link to v4.0.0

## Risk Management & Mitigation

### Critical Risks & Mitigations

#### Risk 1: Enhancement Compatibility Issues

**Risk:** Core API changes break downloaded enhancements

**Mitigation Strategy:**
- [ ] **Semantic versioning with major version pinning**
  - [ ] Core breaking changes â†’ major version bump (3â†’4, 4â†’5)
  - [ ] Enhancement compatible_core_versions pinned (e.g., ">=4.0.0,<5.0.0")
  - [ ] Document in VERSIONING.md

- [ ] **Runtime version compatibility checks**
  - [ ] enhancement_manager.py verifies compatible_core_versions
  - [ ] Rejects incompatible enhancements with clear error message
  - [ ] Falls back to Community if incompatible

- [ ] **Comprehensive integration tests**
  - [ ] Test each major version combination
  - [ ] Test Pro/Enterprise with multiple Community versions
  - [ ] Document version matrix in `docs/VERSION_MATRIX.md`

#### Risk 2: Version Skew (User has mismatched versions)

**Risk:** User has Pro enhancement v4.1.0 but Core v4.0.0

**Mitigation Strategy:**
- [ ] **Automatic version checking on startup**
  - [ ] enhancement_manager.py checks compatible_core_versions
  - [ ] Server startup logs version info: `Core 4.0.0, Pro 4.1.0`
  - [ ] Warn if Pro 4.1.0 may require Core >= 4.0.5

- [ ] **Auto-download compatible version**
  - [ ] If Pro 4.1.0 incompatible with Core 4.0.0
  - [ ] Automatically download Pro 4.0.1 instead
  - [ ] Log decision: `Downgraded Pro from 4.1.0 to 4.0.1`

- [ ] **Diagnostic command for troubleshooting**
  - [ ] `code-scalpel --diagnose` shows all versions + compatibility

#### Risk 3: User Confusion (No action needed but unclear)
**Risk:** Users don't understand automatic enhancement download

**Mitigation Strategy:**
- [ ] **Clear server startup logging**
  ```
  INFO: Code Scalpel v4.0.0 starting
  INFO: License detected: Pro (valid until 2025-12-31)
  INFO: Downloading Pro enhancements (4.0.0)...
  INFO: Pro enhancements loaded successfully
  INFO: All 22 tools available with Pro capabilities
  ```

- [ ] **`code-scalpel --diagnose` output**
  - [ ] Shows current version, license, enhancements
  - [ ] Shows if downloads are working
  - [ ] Shows cached enhancements

- [ ] **Comprehensive documentation**
  - [ ] docs/UPGRADE.md: Step-by-step Pro license setup
  - [ ] docs/FAQ.md: "Why is it downloading?" answer
  - [ ] docs/TROUBLESHOOTING.md: "Download failed" solutions

#### Risk 4: Enhancement Download Infrastructure Failure

**Risk:** Download server unreliable, user can't get Pro enhancements

**Mitigation Strategy:**
- [ ] **CDN distribution**
  - [ ] Primary: custom server
  - [ ] Fallback 1: CloudFront CDN
  - [ ] Fallback 2: GitHub Releases (private repo)
  - [ ] Fallback 3: Artifactory mirror

- [ ] **Health monitoring**
  - [ ] Enhancement server exposes `GET /health/`
  - [ ] Client checks health before download
  - [ ] Alerts if endpoint down > 1 hour

- [ ] **Local caching**
  - [ ] Downloaded once, stored in `~/.code-scalpel/enhancements/{tier}/`
  - [ ] Reused across restarts (no re-download)
  - [ ] Survives server downtime

- [ ] **Offline mode (fallback)**
  - [ ] User can manually place .whl in `~/.code-scalpel/enhancements/{tier}/`
  - [ ] Server loads without downloading
  - [ ] Documented for offline users

- [ ] **Clear error messages**
  - [ ] "Download failed: Connection timeout. Retry in 5s..."
  - [ ] "Offline mode: Manual installation required"
  - [ ] Links to support documentation

#### Risk 5: Private Code Leakage

**Risk:** Pro/Enterprise code accidentally included in Community package

**Mitigation Strategy:**
- [ ] **Automated code scanning**
  - [ ] GitHub Actions scans Community package for Pro/Enterprise keywords
  - [ ] Fails build if pro/enterprise modules detected in Community
  - [ ] Configure in `.github/workflows/validate-separation.yml`

- [ ] **File structure enforcement**
  - [ ] code-scalpel/ directory ONLY contains Community code
  - [ ] code-scalpel-pro/ directory ONLY on private repo
  - [ ] code-scalpel-enterprise/ directory ONLY on private repo
  - [ ] Enforce via CI/CD validation

- [ ] **Manual security audit**
  - [ ] Before each release, audit Community package contents
  - [ ] Verify no imports from pro_features or enterprise_modules
  - [ ] Review for any hardcoded credentials

- [ ] **Test install isolation**
  - [ ] Install Community package in clean environment
  - [ ] Verify Pro/Enterprise modules NOT available
  - [ ] Verify enhancement_loader.py handles missing Pro gracefully

#### Risk 6: License Validation Bypass

**Risk:** User tampers with JWT to get Pro features without license

**Mitigation Strategy:**
- [ ] **JWT signature verification**
  - [ ] licensing/jwt_validator.py verifies RSA signature
  - [ ] Public key in code-scalpel/ (safe)
  - [ ] Private key in secure vault (used to issue licenses only)
  - [ ] Tampered JWT fails signature check

- [ ] **Expiration checking**
  - [ ] All JWTs have `exp` (expiration) claim
  - [ ] Server rejects expired JWTs
  - [ ] Revocation list (for compromise cases)

- [ ] **No runtime enhancement of Community to Pro**
  - [ ] Can't enable Pro features without downloading enhancement package
  - [ ] Enhancement package signed (checksum verified)
  - [ ] Even with fake JWT, missing enhancement package = Community mode

### Risk Monitoring During Rollout

#### 6.11: Rollout Monitoring
- [ ] **Set up monitoring dashboards:**
  - [ ] [ ] PyPI package downloads per day
  - [ ] [ ] Enhancement download success rate
  - [ ] [ ] Enhancement download error rates
  - [ ] [ ] Server startup time metrics
  - [ ] [ ] Customer support ticket volume

- [ ] **Define thresholds for rollback:**
  - [ ] If PyPI install failures > 5% â†’ investigate
  - [ ] If enhancement downloads < 50% success â†’ pause Pro/Enterprise launch
  - [ ] If customer complaints > 10/day â†’ evaluate rollback
  - [ ] If security issues found â†’ immediate rollback

- [ ] **Daily review during Week 1-2:**
  - [ ] Monitor dashboards
  - [ ] Review support tickets
  - [ ] Check error logs
  - [ ] Update status in launch tracker
## Success Metrics & KPIs

### Package Distribution Metrics
- [ ] **Community Package Size:**
  - Target: 788KB â†’ ~250KB (68% reduction)
  - Metric: Measure package size: `pip show code-scalpel | grep Size`
  - Success: < 250KB

- [ ] **Download Size (with dependencies):**
  - Current: ~25MB
  - Target: ~15MB (40% reduction)
  - Metric: Track pip install size over 4 weeks
  - Success: < 18MB (allows for some growth)

- [ ] **Enhancement Download Size:**
  - Pro: ~50-75KB (lean enhancement package)
  - Enterprise: ~75-100KB (includes governance)
  - Metric: Monitor in CI/CD build logs
  - Success: Pro < 100KB, Enterprise < 150KB

### User Adoption Metrics
- [ ] **Community Tier Downloads:**
  - Track PyPI downloads per day
  - Target: 500+ downloads in Week 1, 5000+ by Month 1
  - Dashboard: PyPI stats page

- [ ] **Pro License Activations:**
  - Track license.jwt placements (not directly measurable, butâ€¦)
  - Track Pro enhancement downloads
  - Target: > 30% of community users trial/purchase Pro in first month

- [ ] **Enterprise Tier Adoption:**
  - Track Enterprise license issuance
  - Monitor governance/compliance feature usage
  - Target: Adoption by enterprise customers within 2 months

### Quality Metrics
- [ ] **Test Coverage (Maintain/Improve):**
  - Community: 94% (maintain current baseline)
  - Pro: >= 90%
  - Enterprise: >= 90%
  - Metric: `pytest --cov-report=term-missing`
  - Success: All >= targets

- [ ] **Code Quality:**
  - Zero security vulnerabilities (SonarQube)
  - Pylint score >= 9.5/10
  - No hardcoded secrets
  - Metric: CI/CD pipeline checks
  - Success: All gates pass

- [ ] **Documentation Completeness:**
  - README covers all tiers: âœ“
  - INSTALLATION.md complete: âœ“
  - UPGRADE.md complete: âœ“
  - API docs generated: âœ“
  - Examples for all 22 tools: âœ“
  - Metric: Readability checklist
  - Success: All checkboxes complete

### Performance Metrics
- [ ] **Server Startup Time:**
  - Community (no enhancement): < 5 seconds
  - Pro (auto-download on first boot): < 6 seconds
  - Pro (cached enhancement): < 5.5 seconds
  - Enterprise (auto-download Pro+Enterprise): < 7 seconds
  - Metric: Measure in CI/CD + production monitoring
  - Success: All < target, with <1s variance

- [ ] **Tool Performance (No Regression):**
  - Community tool latency: baseline (from v3.3.0)
  - Pro tool latency: <= baseline + 10%
  - Enterprise tool latency: <= baseline + 20%
  - Metric: Benchmark each tool at each tier
  - Success: No regressions > 20%

### Customer Satisfaction Metrics
- [ ] **Support Ticket Trends:**
  - Target: < 2 critical issues per week during rollout
  - Track: Installation issues, enhancement download issues, license issues
  - Resolution time: < 24 hours for critical, < 72 hours for others
  - Success: Meet targets + positive sentiment in tickets

- [ ] **Community Feedback:**
  - Track GitHub Discussions
  - Track Stack Overflow tags
  - Sentiment: Positive mentions > negative
  - Success: > 80% positive feedback

- [ ] **Customer Satisfaction Score (CSAT):**
  - Pre-launch: Establish baseline
  - Post-launch: Maintain >= baseline
  - Survey: Post-upgrade satisfaction
  - Success: CSAT >= 4.0/5.0

### Security Metrics
- [ ] **Separation Validation:**
  - No Pro code in Community package: âœ“
  - No Enterprise code in Pro/Community: âœ“
  - Private repos access restricted: âœ“
  - Metric: Automated + manual audits
  - Success: 100% compliance (zero findings)

- [ ] **License Enforcement:**
  - JWT validation working: âœ“
  - Tampered JWTs rejected: âœ“
  - Expired JWTs trigger Community fallback: âœ“
  - Metric: Security testing
  - Success: All cases handled correctly

- [ ] **Enhancement Integrity:**
  - Checksum verification success rate: > 99%
  - Zero corrupted downloads: Target = 0
  - Download security (HTTPS): 100%
  - Metric: Automated validation
  - Success: All >= targets

### Release Velocity Metrics
- [ ] **Release Frequency:**
  - Before split: 1 major release per month (all code tested together)
  - After split: Can release Pro/Enterprise independently
  - Community critical patches: Released within 24 hours
  - Pro/Enterprise features: Released weekly (if desired)
  - Metric: Track releases per tier per month
  - Success: Demonstrate independent release capability

- [ ] **Time to Market:**
  - Community bug fix: 24 hours from discovery to release
  - Pro feature: 1-2 weeks from development to release
  - Enterprise feature: 2-4 weeks (includes compliance testing)
  - Metric: Track from issue creation to release tag
  - Success: Meet time targets

### IP Protection Metrics
- [ ] **Code Exposure:**
  - Pro features exposed in Community: 0 files
  - Enterprise features exposed in Community/Pro: 0 files
  - Private repo access violations: 0 incidents
  - Metric: Automated scanning + manual audits
  - Success: Zero violations