# v1.5.1 Development - Team Onboarding Guide

**Release:** Code Scalpel v1.5.1 "CrossFile"  
**Target Date:** Q1 2026 (January-March 2026)  
**Effort:** 15 developer-days  
**Team:** Your Development Team  
**Status:** âœ… Ready for Development

---

## Quick Start for Your Team

### 1. Get the Code

```bash
git clone https://github.com/tescolopio/code-scalpel.git
cd code-scalpel
git checkout main  # Already on latest v1.5.0
```

### 2. Understand v1.5.0 (Current State)

**Key Resources:**
- ðŸ“‹ [Release Notes](docs/release_notes/RELEASE_NOTES_v1.5.0.md) - Features, metrics, migration guide
- ðŸ—ºï¸ [Development Roadmap](DEVELOPMENT_ROADMAP.md) - Acceptance criteria, release timeline
- ðŸ—ï¸ [Architecture](docs/architecture/) - Core design patterns
- ðŸ’» [Examples](examples/) - Usage examples for all MCP tools

**Current Capabilities:**
- 13 MCP tools for surgical code operations
- 203 tests (100% passing, 95%+ coverage)
- Cross-language support planning (TypeScript, JavaScript, Java)
- Dependency vulnerability scanning with OSV API

### 3. Learn v1.5.1 Plan

**Main Document:** [docs/internal/v1.5.1_TECHNICAL_PLAN.md](docs/internal/v1.5.1_TECHNICAL_PLAN.md)

**Quick Overview:**
- **Problem:** v1.5.0 can't track taint across files (vulnerability spanning modules)
- **Solution:** 3 new components:
  1. Import Resolution Engine (build project dependency graph)
  2. Cross-File Extraction (extract symbols with callers/callees)
  3. Cross-File Taint Tracking (detect vulnerabilities across modules)

**Timeline:**
- Week 1: Import Resolution (days 1-5)
- Week 2: Cross-File Extraction (days 6-10)
- Week 3: Cross-File Taint (days 11-15)
- Week 4: Testing & Documentation

### 4. Setup Development Environment

```bash
# Create virtual environment
python3.10 -m venv venv
source venv/bin/activate

# Install development dependencies
pip install -e ".[dev]"

# Verify installation
pytest tests/ -v --tb=short
```

**Expected:** 2,045 tests passing (98.8% pass rate, 24 test isolation issues unrelated to code quality)

### 5. Docker for Easy Testing

```bash
# Build latest Docker images
docker compose build --no-cache

# Start both services
docker compose up -d

# Verify services are running
curl http://localhost:8593/sse -H "Accept: text/event-stream"
curl http://localhost:5000/health
```

---

## Architecture Overview

### v1.5.0 Capabilities (Foundation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          v1.5.0 "Project Intelligence"   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  get_project_map                         â”‚
â”‚  â”œâ”€ Project structure                    â”‚
â”‚  â”œâ”€ Entry points (main, CLI, routes)     â”‚
â”‚  â”œâ”€ Language breakdown (9 file types)    â”‚
â”‚  â””â”€ Complexity hotspots                  â”‚
â”‚                                          â”‚
â”‚  get_call_graph                          â”‚
â”‚  â”œâ”€ Call traces from entry point         â”‚
â”‚  â”œâ”€ File/line information                â”‚
â”‚  â”œâ”€ Mermaid diagrams                     â”‚
â”‚  â””â”€ Recursive call handling              â”‚
â”‚                                          â”‚
â”‚  scan_dependencies                       â”‚
â”‚  â”œâ”€ Parse requirements.txt               â”‚
â”‚  â”œâ”€ Parse pyproject.toml & package.json  â”‚
â”‚  â”œâ”€ Query CVEs (OSV API)                 â”‚
â”‚  â””â”€ Suggest fixed versions               â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### v1.5.1 New Capabilities (Your Task)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          v1.5.1 "CrossFile"              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  PHASE 1: Import Resolution              â”‚
â”‚  â”œâ”€ Build import graph                   â”‚
â”‚  â”œâ”€ Detect circular imports              â”‚
â”‚  â”œâ”€ Resolve relative imports             â”‚
â”‚  â””â”€ Handle __init__.py packages          â”‚
â”‚                                          â”‚
â”‚  PHASE 2: Cross-File Extraction          â”‚
â”‚  â”œâ”€ Extract symbol with callers          â”‚
â”‚  â”œâ”€ Extract symbol with callees          â”‚
â”‚  â”œâ”€ Return import chain                  â”‚
â”‚  â””â”€ Support 3+ file chains               â”‚
â”‚                                          â”‚
â”‚  PHASE 3: Cross-File Taint Tracking      â”‚
â”‚  â”œâ”€ Track taint across imports           â”‚
â”‚  â”œâ”€ Propagate through function calls     â”‚
â”‚  â”œâ”€ Report source & sink files           â”‚
â”‚  â””â”€ Generate taint paths                 â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Development Tasks

### Component 1: Import Resolution (Week 1)

**Owner:** TBD  
**Effort:** 5 developer-days  
**Tests:** 40+  
**Coverage:** 100%

**Deliverables:**
```
src/code_scalpel/ast_tools/import_resolver.py
â”œâ”€ ImportGraph class
â”œâ”€ File crawling
â”œâ”€ Import extraction
â”œâ”€ Circular detection
â””â”€ Path resolution
```

**Key Methods:**
- `build()` - Crawl project, extract imports
- `validate()` - Check for cycles
- `resolve(module, symbol)` - Trace symbol to source
- `topological_sort()` - Order modules safely

**Test File:** `tests/test_import_resolver.py`

**Success Criteria:**
- [x] Resolves "from module import func"
- [x] Resolves "import module"
- [x] Resolves relative imports
- [x] Handles __init__.py packages
- [x] Gracefully fails on circular imports

---

### Component 2: Cross-File Extraction (Week 2)

**Owner:** TBD  
**Effort:** 5 developer-days  
**Tests:** 30+  
**Coverage:** 100%

**Deliverables:**
```
src/code_scalpel/ast_tools/cross_file_extractor.py
â”œâ”€ CallGraphAnalyzer class
â”œâ”€ find_callers() method
â”œâ”€ find_callees() method
â”œâ”€ CrossFileExtraction model
â””â”€ MCP tool integration
```

**MCP Tool Signature:**
```python
async def extract_cross_file(
    symbol_name: str,
    project_root: str,
    include_callers: bool = True,
    include_callees: bool = True,
    max_depth: int = None
) -> CrossFileExtraction
```

**Test File:** `tests/test_cross_file_extractor.py`

**Success Criteria:**
- [x] extract_cross_file: Extracts symbol with callers
- [x] extract_cross_file: Extracts symbol with callees
- [x] extract_cross_file: Returns import chain
- [x] extract_cross_file: Works across 3+ files

---

### Component 3: Cross-File Taint (Week 3)

**Owner:** TBD  
**Effort:** 5 developer-days  
**Tests:** 35+  
**Coverage:** 100%

**Deliverables:**
```
src/code_scalpel/security/cross_file_taint.py
â”œâ”€ CrossFileTaintTracker class
â”œâ”€ Inter-procedural analysis
â”œâ”€ Taint propagation
â”œâ”€ Path reconstruction
â””â”€ Example file
```

**Key Challenge:**
Detect SQL injection that spans files:
```python
# views.py â†’ models.py â†’ database.py
user_id = request.args['id']  # SOURCE
    â†“
get_user(user_id)  # PROPAGATE
    â†“
query = f"SELECT * WHERE id={user_id}"  # SINK (VULNERABILITY)
```

**Test File:** `tests/test_cross_file_taint.py`

**Success Criteria:**
- [x] Tracks taint through function calls
- [x] Detects SQL injection across 2 files
- [x] Detects command injection across 2 files
- [x] Reports source & sink files
- [x] Reports full taint propagation path

---

## Code Style & Standards

### Required

- âœ… **Type hints** on all functions
- âœ… **Docstrings** on all public methods
- âœ… **100% test coverage** on new modules
- âœ… **Ruff lint:** `ruff check src/`
- âœ… **Black format:** `black src/ tests/`
- âœ… **Change tags:** `[YYYYMMDD_TYPE]` on all edits

### Example Change

```python
# [20260113_FEATURE] New ImportGraph class for cross-file analysis
class ImportGraph:
    """Build and query module import relationships.
    
    This class handles:
    - Walking the project file tree
    - Parsing Python imports
    - Building dependency graph
    - Detecting circular imports
    
    Example:
        >>> graph = ImportGraph(project_root="/myproject")
        >>> graph.build()
        >>> module, symbol = graph.resolve("views", "get_user")
    """
    
    def __init__(self, project_root: str) -> None:
        """Initialize import graph builder."""
        self.project_root = Path(project_root)
        self.edges: Dict[str, List[str]] = {}
```

---

## Testing Strategy

### Unit Tests (150+ tests)

Create comprehensive tests for each component:

```bash
# Run only import resolver tests
pytest tests/test_import_resolver.py -v

# Run with coverage
pytest tests/test_import_resolver.py --cov=src/code_scalpel/ast_tools/import_resolver --cov-report=html

# Run specific test
pytest tests/test_import_resolver.py::TestImportGraph::test_resolves_direct_imports -v
```

### Integration Tests (30+ tests)

Test cross-component interactions:

```python
# Example: Multi-file project with circular imports
def test_circular_imports_handled_gracefully():
    graph = ImportGraph(project_root="fixtures/circular_project")
    assert graph.build() == False  # Graceful failure
    assert len(graph.circular_imports) == 1
    assert graph.circular_imports[0] == ["a.py", "b.py", "a.py"]
```

### Performance Tests

```python
# Ensure performance targets met
def test_50_file_project_analyzed_in_under_30_seconds():
    graph = ImportGraph(project_root="fixtures/50_file_project")
    start = time.time()
    graph.build()
    elapsed = time.time() - start
    assert elapsed < 30.0, f"Analysis took {elapsed:.2f}s, target <30s"
```

---

## Documentation Requirements

### Code Documentation

Every public module, class, and function needs:
1. **Docstring** explaining purpose
2. **Args** with types
3. **Returns** with types
4. **Examples** showing usage
5. **Raises** for exceptions

### Release Documentation

Before completing v1.5.1:
1. **Release Notes** - `docs/release_notes/RELEASE_NOTES_v1.5.1.md`
2. **Evidence Files** - `release_artifacts/v1.5.1/*.json`
3. **API Documentation** - Updated docs/
4. **Migration Guide** - For v1.5.0 users

---

## Key Files & Directories

```
code-scalpel/
â”œâ”€â”€ src/code_scalpel/
â”‚   â”œâ”€â”€ ast_tools/          # AST parsing & analysis
â”‚   â”‚   â”œâ”€â”€ call_graph.py   # Study this first
â”‚   â”‚   â”œâ”€â”€ import_resolver.py  # NEW: Build this
â”‚   â”‚   â””â”€â”€ cross_file_extractor.py  # NEW: Build this
â”‚   â”œâ”€â”€ security/
â”‚   â”‚   â”œâ”€â”€ taint_analyzer.py   # Study this
â”‚   â”‚   â””â”€â”€ cross_file_taint.py  # NEW: Build this
â”‚   â””â”€â”€ mcp/
â”‚       â””â”€â”€ server.py        # Add new tools here
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_import_resolver.py  # NEW
â”‚   â”œâ”€â”€ test_cross_file_extractor.py  # NEW
â”‚   â””â”€â”€ test_cross_file_taint.py  # NEW
â””â”€â”€ docs/
    â”œâ”€â”€ release_notes/
    â”‚   â””â”€â”€ RELEASE_NOTES_v1.5.1.md  # NEW
    â””â”€â”€ internal/
        â””â”€â”€ v1.5.1_TECHNICAL_PLAN.md  # Already exists
```

---

## Common Pitfalls (Avoid These!)

### 1. Circular Import Crashes

**Problem:** If A imports B and B imports A, naive code will loop forever.

**Solution:** Detect cycles in `build()`, return gracefully.

```python
def build(self):
    self._detect_cycles()
    if self.circular_imports:
        return False  # Graceful failure
    # ... continue building
```

### 2. Dynamic Imports Can't Be Resolved

**Problem:** `importlib.import_module(user_input)` can't be analyzed statically.

**Solution:** Document as limitation, skip gracefully.

```python
if is_dynamic_import(node):
    logger.warn(f"Skipping dynamic import in {file_path}")
    continue  # Don't crash, just skip
```

### 3. Test Isolation Issues

**Problem:** Tests that modify global state affect other tests.

**Solution:** Always clean up in `teardown()`.

```python
def teardown_method(self):
    """Clean up after each test."""
    # Reset any global state
    # Close temp files
    # Clear mocks
```

### 4. Taint Explosion

**Problem:** Too many taint paths (exponential growth).

**Solution:** Implement path bounding, report most likely paths.

```python
MAX_TAINT_PATHS = 100
if len(self.taint_paths) > MAX_TAINT_PATHS:
    logger.warn(f"Truncated {len(self.taint_paths)} paths to {MAX_TAINT_PATHS}")
    self.taint_paths = self.taint_paths[:MAX_TAINT_PATHS]
```

---

## Acceptance Criteria Checklist

### Phase 1: Import Resolution

- [ ] ImportGraph class created
- [ ] File crawling works
- [ ] Import extraction works
- [ ] Circular detection works
- [ ] 40+ tests passing
- [ ] 100% coverage
- [ ] Ruff lint passes
- [ ] Black format passes

### Phase 2: Cross-File Extraction

- [ ] CallGraphAnalyzer created
- [ ] find_callers() implemented
- [ ] find_callees() implemented
- [ ] MCP tool registered
- [ ] 30+ tests passing
- [ ] 100% coverage
- [ ] Ruff lint passes
- [ ] Black format passes

### Phase 3: Cross-File Taint

- [ ] CrossFileTaintTracker created
- [ ] Inter-procedural analysis works
- [ ] Taint propagation works
- [ ] Taint paths reconstructed
- [ ] 35+ tests passing
- [ ] 100% coverage
- [ ] Examples provided
- [ ] Ruff lint passes

### Release Gates

- [ ] All 150+ unit tests passing
- [ ] All 30+ integration tests passing
- [ ] 95%+ code coverage (new modules)
- [ ] No regressions in v1.5.0
- [ ] Performance < 30s for 50-file project
- [ ] Release notes complete
- [ ] Evidence files generated
- [ ] Accepted by QA

---

## Getting Help

### Resources

1. **v1.5.1 Technical Plan** - [docs/internal/v1.5.1_TECHNICAL_PLAN.md](docs/internal/v1.5.1_TECHNICAL_PLAN.md)
2. **v1.5.0 Release Notes** - [docs/release_notes/RELEASE_NOTES_v1.5.0.md](docs/release_notes/RELEASE_NOTES_v1.5.0.md)
3. **Development Roadmap** - [DEVELOPMENT_ROADMAP.md](DEVELOPMENT_ROADMAP.md)
4. **Code Examples** - [examples/](examples/)
5. **API Reference** - [docs/api_reference.md](docs/api_reference.md)

### Study Existing Code

Start by understanding v1.5.0 components you'll build on:

```bash
# Study import handling in existing code
grep -r "import.*analysis" src/code_scalpel/ --include="*.py"

# Study AST-based code analysis
cat src/code_scalpel/ast_tools/call_graph.py

# Study taint tracking
cat src/code_scalpel/security/taint_analyzer.py

# Study MCP tool integration
cat src/code_scalpel/mcp/server.py | grep "async def"
```

### Ask Questions

When blocked:
1. Check the technical plan
2. Search existing code for examples
3. Review test cases for expected behavior
4. Ask on GitHub issues if truly stuck

---

## Next Steps

1. âœ… **Read this guide** (you are here)
2. ðŸ“‹ **Review v1.5.1 Technical Plan** - ~30 min read
3. ðŸ”§ **Setup dev environment** - Install dependencies
4. ðŸ“š **Study v1.5.0 code** - Understand patterns
5. âœï¸ **Start Phase 1** - Import Resolution (week 1)
6. ðŸ§ª **Write tests first** - TDD approach (mandatory)
7. ðŸ“ **Document as you go** - Docstrings & comments
8. ðŸ”„ **Create PRs for review** - Peer review before merging

---

## Questions?

Before starting development, make sure:
1. You've read the v1.5.1 Technical Plan
2. You understand the problem being solved
3. You've reviewed similar code in v1.5.0
4. You have your dev environment working
5. You can run the test suite successfully

Good luck! We're excited to have your team build v1.5.1! ðŸš€

