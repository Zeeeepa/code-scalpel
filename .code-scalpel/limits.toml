# Code Scalpel Tier Limits Configuration
# [20251225_CONFIG] Centralized configuration for tier-based feature limits
# [20251227_REFACTOR] Removed tier-based timeouts - use uniform generous safeguard
#
# This file defines the capability limits for each tool at each tier.
# It is packaged with MCP server distributions and can be customized
# without rebuilding the Python package.
#
# Override Priority:
#   1. Environment: CODE_SCALPEL_LIMITS_FILE=/path/to/custom.toml
#   2. Project: .code-scalpel/limits.toml (this file)
#   3. User: ~/.code-scalpel/limits.toml
#   4. System: /etc/code-scalpel/limits.toml
#   5. Defaults: Hardcoded in features.py
#
# Local overrides: Create .code-scalpel/limits.local.toml (gitignored)

# ============================================================================
# GLOBAL SETTINGS (apply to all tiers)
# ============================================================================
# [20251227_CONFIG] Timeouts are NOT tier-differentiated - they are safeguards.
# The depth/file/node limits naturally bound execution time.
# Timeout should only trigger for pathological cases (infinite loops, hung IO).

[global]
default_timeout_seconds = 120  # Generous safeguard for all tiers

# ============================================================================
# SCANNER CONFIGURATION (Tier-Based Data Volume Limits)
# ============================================================================
# [20260126_ORACLE] Universal scanner limits that apply to ALL crawling tools.
# These limits define the "perception layer" for each tier:
# - Community: Can see shallow context (good for local refactoring)
# - Pro: Can see project-wide context (good for safe refactoring)
# - Enterprise: Can see everything (good for large monoliths)
#
# These limits are inherited by:
# - ProjectCrawler (for project discovery)
# - Oracle tools (write_perfect_code, enforce_topology, predict_regression_risk)
# - Any tool that needs to understand project context

[community.scanner]
# Community tier: Limited visibility (safety net)
# Good for: Single-file refactoring, local validation
max_files = 50        # Stop after 50 files
max_depth = 2         # Only follow imports 2 levels deep
max_symbol_count = 1000

[pro.scanner]
# Pro tier: Full project visibility
# Good for: Cross-file refactoring, architecture changes, confident decisions
max_files = 2000      # Up to 2000 files
max_depth = 10        # Follow imports 10 levels deep
max_symbol_count = 50000

[enterprise.scanner]
# Enterprise tier: Unlimited visibility
# Good for: Large monoliths, complete safety with zero blindspots
# (Limits are omitted to indicate "unlimited" per [global] processing)
max_files = 100000
max_depth = 50
max_symbol_count = 1000000

# ============================================================================
# GROUP 1: ANALYSIS & DISCOVERY
# ============================================================================

[community.analyze_code]
max_file_size_mb = 1
languages = ["python", "javascript", "typescript", "java"]

[pro.analyze_code]
max_file_size_mb = 10
# [20260110_BUGFIX] Removed go/rust until implementation exists (roadmap: Q1 2026)
languages = ["python", "javascript", "typescript", "java"]

[enterprise.analyze_code]
max_file_size_mb = 100
# languages unlimited - omit
# languages unlimited - all languages supported

# ----------------------------------------------------------------------------

[community.get_file_context]
# [20260123_FIX] Renamed to match features.py - this is an OUTPUT limit (lines returned)
max_context_lines = 500

[pro.get_file_context]
max_context_lines = 2000

[enterprise.get_file_context]
# max_context_lines unlimited - omit

# ----------------------------------------------------------------------------

[community.get_project_map]
max_files = 100
max_modules = 50
detail_level = "basic"

[pro.get_project_map]
max_files = 1000
max_modules = 200
detail_level = "detailed"

[enterprise.get_project_map]
# max_files unlimited - omit
max_modules = 1000
detail_level = "comprehensive"

# ----------------------------------------------------------------------------

[community.get_symbol_references]
max_files_searched = 10
max_references = 50

[pro.get_symbol_references]
# max_files and max_references unlimited - omit

[enterprise.get_symbol_references]
# All limits unlimited - omit

# ----------------------------------------------------------------------------

[community.crawl_project]
max_files = 100
parsing_enabled = false
complexity_analysis = false
respect_gitignore = true

[pro.crawl_project]
# [20260106_FIX] max_files unlimited for Pro tier - removed hardcoded 1000 limit
# to match features.py TOOL_CAPABILITIES which sets max_files = None
parsing_enabled = true
complexity_analysis = true
respect_gitignore = true

[enterprise.crawl_project]
# max_files unlimited - omit
parsing_enabled = true
complexity_analysis = true
respect_gitignore = true

# ============================================================================
# GROUP 2: GRAPH & DEPENDENCIES
# ============================================================================

[community.get_call_graph]
max_depth = 3
max_nodes = 50

[pro.get_call_graph]
max_depth = 50
max_nodes = 500

[enterprise.get_call_graph]
# max_depth and max_nodes unlimited - omit

# ----------------------------------------------------------------------------

[community.get_cross_file_dependencies]
max_depth = 1
max_files = 50
# timeout_seconds inherited from [global] - NOT a tier limit

[pro.get_cross_file_dependencies]
max_depth = 5
max_files = 500
# timeout_seconds inherited from [global] - NOT a tier limit

[enterprise.get_cross_file_dependencies]
# max_depth and max_files unlimited - omit
# timeout_seconds inherited from [global] - NOT a tier limit

# ----------------------------------------------------------------------------

[community.get_graph_neighborhood]
max_k = 1
max_nodes = 20

[pro.get_graph_neighborhood]
max_k = 5
max_nodes = 100

[enterprise.get_graph_neighborhood]
# max_k and max_nodes unlimited - omit

# ----------------------------------------------------------------------------

[community.scan_dependencies]
max_dependencies = 50
osv_lookup = true

[pro.scan_dependencies]
# max_dependencies unlimited - omit
osv_lookup = true

[enterprise.scan_dependencies]
# All unlimited - omit
osv_lookup = true

# ----------------------------------------------------------------------------
# [20251231_FIX] v1.1 - Restored Community tier per verification document

[community.type_evaporation_scan]
max_files = 50
frontend_only = true

[pro.type_evaporation_scan]
max_files = 500

[enterprise.type_evaporation_scan]
# max_files unlimited - omit

# ============================================================================
# GROUP 3: SECURITY & SAFETY
# ============================================================================

[community.security_scan]
max_findings = 50
max_file_size_kb = 500

[pro.security_scan]
# max_findings and max_file_size_kb unlimited - omit

[enterprise.security_scan]
# All unlimited - omit
# custom_rules_limit checked as None in Python

# ----------------------------------------------------------------------------

[community.cross_file_security_scan]
max_modules = 10
max_depth = 3

[pro.cross_file_security_scan]
max_modules = 100
max_depth = 10

[enterprise.cross_file_security_scan]
# max_modules and max_depth unlimited - omit

# ----------------------------------------------------------------------------

[community.unified_sink_detect]
languages = ["python", "javascript", "typescript", "java"]
max_sinks = 50

[pro.unified_sink_detect]
# [20260110_BUGFIX] Align tier language contract with UnifiedSinkDetector (python/js/ts/java only)
languages = ["python", "javascript", "typescript", "java"]
# max_sinks unlimited - omit

[enterprise.unified_sink_detect]
# languages = "all" handled in code
# max_sinks and custom_sinks_limit unlimited - omit

# ----------------------------------------------------------------------------

[community.validate_paths]
max_paths = 100

[pro.validate_paths]
# max_paths unlimited - omit

[enterprise.validate_paths]
# max_paths unlimited - omit

# ----------------------------------------------------------------------------
# [20251231_CONFIG] Updated verify_policy_integrity limits per v1.0 roadmap

[community.verify_policy_integrity]
max_policy_files = 50

[pro.verify_policy_integrity]
max_policy_files = 200

[enterprise.verify_policy_integrity]
# max_policy_files unlimited - omit

# ----------------------------------------------------------------------------
# [20251226_CONFIG] Added code_policy_check limits

[community.code_policy_check]
max_files = 100
max_rules = 50
compliance_enabled = false
custom_rules_enabled = false

[pro.code_policy_check]
max_files = 1000
max_rules = 200
compliance_enabled = false
custom_rules_enabled = true

[enterprise.code_policy_check]
# max_files and max_rules unlimited - omit
compliance_enabled = true
custom_rules_enabled = true
audit_trail_enabled = true
pdf_reports_enabled = true

# ============================================================================
# GROUP 4: SURGICAL REFACTORING & VERIFICATION
# ============================================================================

[community.extract_code]
include_cross_file_deps = false
# [20260111_BUGFIX] Fixed max_depth to match features.py (was 1, should be 0 - no context for Community)
max_depth = 0
max_extraction_size_mb = 1

[pro.extract_code]
include_cross_file_deps = true
# Pro: direct dependencies only (tier contract); deeper recursion is Enterprise.
max_depth = 1
max_extraction_size_mb = 10

[enterprise.extract_code]
include_cross_file_deps = true
# max_depth unlimited - omit
max_extraction_size_mb = 100

# ----------------------------------------------------------------------------

[community.update_symbol]
backup_enabled = true
validation_level = "syntax"
# [20260121_REFACTOR] Switched to stateless per-call throughput cap
# Community: up to 10 updates per call; each call is independent (no session state)
max_updates_per_call = 10

[pro.update_symbol]
backup_enabled = true
validation_level = "semantic"
# [20260121_REFACTOR] Per-call model; Pro has unlimited updates
max_updates_per_call = -1

[enterprise.update_symbol]
backup_enabled = true
validation_level = "full"
# [20260121_REFACTOR] Per-call model; Enterprise has unlimited updates
max_updates_per_call = -1

# ----------------------------------------------------------------------------

[community.rename_symbol]
# Community: definition-only rename (no cross-file updates)
max_files_searched = 0
max_files_updated = 0

[pro.rename_symbol]
# Pro: cross-file rename with bounded scope
max_files_searched = 500
max_files_updated = 200

[enterprise.rename_symbol]
# Enterprise: unlimited by omission (no max_files_* keys)

# ----------------------------------------------------------------------------

[community.simulate_refactor]
max_file_size_mb = 1
analysis_depth = "basic"

[pro.simulate_refactor]
max_file_size_mb = 10
analysis_depth = "advanced"

[enterprise.simulate_refactor]
max_file_size_mb = 100
analysis_depth = "deep"

# ----------------------------------------------------------------------------

# [20251230_FEATURE] v1.0 roadmap alignment - updated limits
[community.symbolic_execute]
max_paths = 50  # Roadmap v1.0: 50 paths max
max_depth = 10  # max loop iterations
constraint_types = ["int", "bool", "string", "float"]

[pro.symbolic_execute]
# max_paths unlimited per roadmap v1.0
max_depth = 100  # Deeper loop unrolling
constraint_types = ["int", "bool", "string", "float", "list", "dict"]

[enterprise.symbolic_execute]
# max_paths and max_depth unlimited - omit
constraint_types = "all"

# ----------------------------------------------------------------------------

[community.generate_unit_tests]
max_test_cases = 5
test_frameworks = ["pytest"]

[pro.generate_unit_tests]
max_test_cases = 20
test_frameworks = ["pytest", "unittest"]
# NOTE: limits.toml controls *limits/tunables* only.
# Capabilities like data-driven tests / bug reproduction remain code-defined and license-gated.

[enterprise.generate_unit_tests]
# max_test_cases unlimited - omit
test_frameworks = "all"

# ============================================================================
# GROUP 5: ORACLE TOOLS (AI-ASSISTED CODE GENERATION)
# ============================================================================
# [20260126_ORACLE_PHASE1B] Refactored to be tier-agnostic.
# Oracle is now a universal right: ALL tiers can use it.
# The tier-based limits come implicitly from the scanner limits above:
# - Community: Sees shallow context (50 files, depth 2) → safer but less informed specs
# - Pro: Sees project context (2000 files, depth 10) → full architectural insights
# - Enterprise: Sees everything (100k files, depth 50) → complete safety for large monoliths
#
# This design implements "Safety is not an Upsell":
# All users get accurate constraint specs, just with tiered visibility depth.
#
# NOTE: Do NOT add [community.write_perfect_code] with allow_use=false.
# That is explicit feature gating. We use implicit tiering via scanner limits instead.

[pro.write_perfect_code]
# Pro tier: Full Oracle with project-wide visibility
# Inherits: max_files=2000, max_depth=10 from [pro.scanner]
cache_ttl_seconds = 300

[enterprise.write_perfect_code]
# Enterprise tier: Oracle with complete visibility
# Inherits: max_files=100000, max_depth=50 from [enterprise.scanner]
cache_ttl_seconds = 300

# ============================================================================
# DEPLOYMENT NOTES
# ============================================================================
#
# For packaged distributions:
#   - This file is included in the Python package via MANIFEST.in
#   - Deployers can edit this file to tune limits without recompiling
#   - Changes take effect on server restart
#
# For development:
#   - Create .code-scalpel/limits.local.toml for personal overrides
#   - Set CODE_SCALPEL_LIMITS_FILE env var to use alternate config
#   - Use CODE_SCALPEL_TIER=enterprise to test unlimited features
#
# Examples:
#
#   # Test with unlimited depth locally
#   [pro.extract_code]
#   max_depth = 999
#
#   # Increase community limits for demos
#   [community.security_scan]
#   max_findings = 100
#
